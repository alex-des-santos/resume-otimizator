<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Otimizador de Curr√≠culo com IA v4</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- pdf.js and jspdf for PDF handling -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- marked.js for Markdown to HTML conversion -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
        
        /* Styles for generated content */
        .prose-output h1, .prose-output h2, .prose-output h3, .prose-output h4 { font-weight: bold; margin-top: 1rem; margin-bottom: 0.5rem; }
        .prose-output h1 { font-size: 1.5rem; }
        .prose-output h2 { font-size: 1.25rem; }
        .prose-output h3 { font-size: 1.1rem; }
        .prose-output h4 { font-size: 1rem; color: #4a5568; }
        .prose-output ul { list-style-type: disc; margin-left: 1.5rem; }
        .prose-output li { margin-bottom: 0.25rem; }
        .prose-output p { margin-bottom: 0.5rem; }
        
        /* Loading spinner for feature buttons */
        .feature-loader {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3498db;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4 md:p-8">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900">Assistente de Carreira com IA</h1>
            <p class="mt-2 text-md text-gray-600">Otimize seu curr√≠culo, prepare-se para a entrevista e fortale√ßa sua presen√ßa profissional.</p>
        </header>

        <!-- Main Content -->
        <main class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Input Section -->
            <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200 flex flex-col">
                <h2 class="text-2xl font-semibold mb-6 text-gray-800">1. Forne√ßa os Dados</h2>

                <div class="mb-6">
                    <label for="apiKey" class="block text-sm font-medium text-gray-700 mb-1">Sua Chave de API do Google AI Studio</label>
                    <input type="password" id="apiKey" class="w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition" placeholder="Cole sua chave de API aqui">
                    <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-xs text-indigo-600 hover:underline mt-1 block">N√£o tem uma chave? Crie uma aqui.</a>
                </div>

                <div class="mb-6">
                    <label for="jobDescription" class="block text-sm font-medium text-gray-700 mb-1">Descri√ß√£o da Vaga</label>
                    <textarea id="jobDescription" rows="8" class="w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition" placeholder="Cole a descri√ß√£o completa da vaga..."></textarea>
                </div>

                <div class="mb-6">
                    <label for="resumeFile" class="block text-sm font-medium text-gray-700 mb-1">Seu Curr√≠culo em PDF</label>
                    <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-lg">
                        <div class="space-y-1 text-center">
                            <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true"><path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></svg>
                            <div class="flex text-sm text-gray-600"><label for="resumeFile" class="relative cursor-pointer bg-white rounded-md font-medium text-indigo-600 hover:text-indigo-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-indigo-500"><span>Anexar o curr√≠culo</span><input id="resumeFile" name="resumeFile" type="file" class="sr-only" accept=".pdf"></label><p class="pl-1">ou arraste e solte</p></div>
                            <p id="fileName" class="text-xs text-gray-500">Apenas PDF</p>
                        </div>
                    </div>
                </div>

                <button id="generateButton" class="w-full mt-auto bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-300 ease-in-out flex items-center justify-center">
                    <svg id="loader" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                    <span id="buttonText">Gerar Curr√≠culo Otimizado</span>
                </button>
            </div>

            <!-- Output Section -->
            <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200 flex flex-col">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-semibold text-gray-800">2. Resultado</h2>
                    <button id="downloadPdfButton" class="bg-green-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition disabled:bg-gray-400 disabled:cursor-not-allowed" disabled>Baixar PDF</button>
                </div>
                <div id="outputContainer" class="w-full h-[45vh] bg-gray-50 border border-gray-200 rounded-lg p-4 overflow-y-auto prose-output">
                    <div id="markdown-preview"><p class="text-gray-500">Seu curr√≠culo otimizado aparecer√° aqui...</p></div>
                </div>
                
                <!-- AI Assistant Features -->
                <div id="aiFeatures" class="mt-6 pt-6 border-t border-gray-200">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Assistente de Candidatura</h3>                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                        <button id="coverLetterButton" class="feature-btn" disabled>‚ú® Rascunhar Carta</button>
                        <button id="linkedinButton" class="feature-btn" disabled>‚ú® Otimizar LinkedIn</button>
                        <button id="analyzeButton" class="feature-btn" disabled>‚ú® Analisar Pontos Fortes</button>
                        <button id="questionsButton" class="feature-btn" disabled>‚ú® Gerar Perguntas</button>
                        <button id="pitchButton" class="feature-btn" disabled>‚ú® Gerar Pitch Pessoal</button>
                        <button id="starButton" class="feature-btn" disabled>‚ú® Estruturar Experi√™ncias</button>
                        <button id="salaryButton" class="feature-btn" disabled>üí∞ Calcular Pretens√£o Salarial</button>
                        <button id="followupButton" class="feature-btn md:col-span-2 lg:col-span-3" disabled>‚ú® Gerar E-mail de Follow-up</button>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- Error Modal -->
        <div id="errorModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
            <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white"><div class="mt-3 text-center"><div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100"><svg class="h-6 w-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg></div><h3 id="errorModalTitle" class="text-lg leading-6 font-medium text-gray-900">Erro!</h3><div class="mt-2 px-7 py-3"><p id="errorModalMessage" class="text-sm text-gray-500"></p></div><div class="items-center px-4 py-3"><button id="closeErrorModalButton" class="px-4 py-2 bg-gray-500 text-white text-base font-medium rounded-md w-full shadow-sm hover:bg-gray-600">Fechar</button></div></div></div>
        </div>
        
        <!-- Content Modal for AI Features -->
        <div id="contentModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
             <div class="relative top-10 mx-auto p-5 border w-full max-w-2xl shadow-lg rounded-md bg-white">
                <div class="flex justify-between items-center pb-3 border-b">
                    <h3 id="contentModalTitle" class="text-xl leading-6 font-bold text-gray-900">Resultado da IA</h3>
                    <button id="closeContentModalButton" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center">&times;</button>
                </div>
                <div id="contentModalBody" class="mt-4 max-h-[70vh] overflow-y-auto prose-output p-2">
                    <!-- Content will be injected here -->
                </div>
             </div>
        </div>

    </div>

    <script type="module">
        // --- Setup ---
        pdfjsLib.GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js`;
        const { jsPDF } = window.jspdf;
        
        // --- DOM Elements ---
        const apiKeyInput = document.getElementById('apiKey');
        const jobDescriptionInput = document.getElementById('jobDescription');
        const resumeFileInput = document.getElementById('resumeFile');
        const fileNameDisplay = document.getElementById('fileName');
        const generateButton = document.getElementById('generateButton');
        const downloadPdfButton = document.getElementById('downloadPdfButton');
        const markdownPreview = document.getElementById('markdown-preview');
        const loader = document.getElementById('loader');
        const buttonText = document.getElementById('buttonText');
        
        const errorModal = document.getElementById('errorModal');
        const errorModalTitle = document.getElementById('errorModalTitle');
        const errorModalMessage = document.getElementById('errorModalMessage');
        const closeErrorModalButton = document.getElementById('closeErrorModalButton');
        
        const contentModal = document.getElementById('contentModal');
        const contentModalTitle = document.getElementById('contentModalTitle');
        const contentModalBody = document.getElementById('contentModalBody');
        const closeContentModalButton = document.getElementById('closeContentModalButton');
          // [MODIFICADO] Adicionados novos bot√µes de features
        const featureButtons = {
            analyze: document.getElementById('analyzeButton'),
            questions: document.getElementById('questionsButton'),
            coverLetter: document.getElementById('coverLetterButton'),
            linkedin: document.getElementById('linkedinButton'),
            followup: document.getElementById('followupButton'),
            pitch: document.getElementById('pitchButton'),
            star: document.getElementById('starButton'),
            salary: document.getElementById('salaryButton'),
        };
        
        // --- State ---
        let resumeText = '';
        let optimizedMarkdown = '';
        
        const baseBtnClasses = "w-full text-sm text-center font-semibold py-2 px-3 rounded-lg transition duration-300 ease-in-out flex items-center justify-center";
        const enabledBtnClasses = "bg-blue-100 text-blue-800 hover:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500";
        const disabledBtnClasses = "bg-gray-200 text-gray-500 cursor-not-allowed";
        
        Object.values(featureButtons).forEach(btn => {
            let classList = btn.className;
            let finalClasses = baseBtnClasses + ' ' + disabledBtnClasses;
            if (classList.includes('md:col-span-2')) finalClasses = 'md:col-span-2 ' + finalClasses;
            if (classList.includes('lg:col-span-3')) finalClasses = 'lg:col-span-3 ' + finalClasses;
            btn.className = finalClasses;
        });

        // --- Event Listeners ---
        resumeFileInput.addEventListener('change', handleFileSelect);
        generateButton.addEventListener('click', handleResumeGeneration);
        downloadPdfButton.addEventListener('click', downloadAsPdf);
        closeErrorModalButton.addEventListener('click', () => errorModal.classList.add('hidden'));
        closeContentModalButton.addEventListener('click', () => contentModal.classList.add('hidden'));
        
        // [MODIFICADO] Adicionados listeners para todos os bot√µes
        Object.keys(featureButtons).forEach(key => {
            featureButtons[key].addEventListener('click', (e) => handleFeatureClick(e.currentTarget, key));
        });

        // --- Core Functions ---

        async function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file && file.type === 'application/pdf') {
                fileNameDisplay.textContent = file.name;
                fileNameDisplay.classList.remove('text-red-500');
                try {
                    resumeText = await extractTextFromPdf(file);
                } catch (err) {
                    showError('Erro no PDF', 'N√£o foi poss√≠vel ler o conte√∫do do arquivo PDF.');
                    resumeText = '';
                }
            } else {
                fileNameDisplay.textContent = 'Arquivo inv√°lido. Apenas PDF √© permitido.';
                fileNameDisplay.classList.add('text-red-500');
                resumeText = '';
            }
        }
        
        async function extractTextFromPdf(file) {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
            let fullText = '';
            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const textContent = await page.getTextContent();
                fullText += textContent.items.map(item => item.str).join(' ');
            }
            return fullText;
        }

        async function handleResumeGeneration() {
            toggleMainLoader(true);
            try {
                const prompt = getPrompt('optimize');
                const result = await callGeminiAPI(prompt);
                optimizedMarkdown = result;
                markdownPreview.innerHTML = marked.parse(optimizedMarkdown);
                downloadPdfButton.disabled = false;
                enableFeatureButtons(true);
            } catch (error) {
                showError('Erro na Otimiza√ß√£o', error.message);
                markdownPreview.innerHTML = `<p class="text-red-500">Falha ao gerar o curr√≠culo. Verifique sua chave de API e os dados fornecidos.</p>`;
                downloadPdfButton.disabled = true;
                enableFeatureButtons(false);
            } finally {
                toggleMainLoader(false);
            }
        }

        async function handleFeatureClick(button, feature) {
            if (button.disabled) return;
            toggleFeatureLoader(button, true);
            try {
                const prompt = getPrompt(feature, optimizedMarkdown);
                const result = await callGeminiAPI(prompt);                // [MODIFICADO] Adicionados t√≠tulos para as novas features
                const titles = {
                    analyze: "An√°lise de Pontos Fortes e Fracos",
                    questions: "Sugest√µes para Entrevista",
                    coverLetter: "Rascunho da Carta de Apresenta√ß√£o",
                    linkedin: "Otimiza√ß√£o para Perfil do LinkedIn",
                    followup: "Rascunho de E-mail de Agradecimento",
                    pitch: "Gerador de Pitch Pessoal",
                    star: "Construtor de Hist√≥rias (M√©todo STAR)",
                    salary: "An√°lise de Pretens√£o Salarial"
                };
                showContentModal(titles[feature], result);
            } catch (error) {
                showError(`Erro na feature: ${feature}`, error.message);
            } finally {
                toggleFeatureLoader(button, false);
            }
        }

        async function callGeminiAPI(prompt) {
            const apiKey = apiKeyInput.value.trim();
            const jobDescription = jobDescriptionInput.value.trim();
            
            if (!apiKey || !jobDescription || !resumeText) {
                let missing = [];
                if (!apiKey) missing.push("Chave de API");
                if (!jobDescription) missing.push("Descri√ß√£o da Vaga");
                if (!resumeText) missing.push("Curr√≠culo em PDF");
                throw new Error(`Dados Incompletos. Por favor, preencha: ${missing.join(', ')}.`);
            }

            const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error?.message || `Erro na API: ${response.statusText}`);
            }

            const result = await response.json();

            if (result.candidates && result.candidates.length > 0 && result.candidates[0].content.parts[0].text) {
                return result.candidates[0].content.parts[0].text;
            } else {
                 throw new Error("A API n√£o retornou uma resposta v√°lida. A resposta pode estar bloqueada por pol√≠ticas de seguran√ßa.");
            }
        }
        
        function downloadAsPdf() {
            if (!optimizedMarkdown) {
                showError('Nenhum Conte√∫do', 'N√£o h√° curr√≠culo gerado para baixar.');
                return;
            }

            const doc = new jsPDF({ orientation: 'p', unit: 'pt', format: 'a4' });
            
            const pageWidth = doc.internal.pageSize.getWidth();
            const margin = 40;
            const contentWidth = pageWidth - margin * 2;
            let cursorY = margin;
            doc.setFont('Helvetica', 'normal');

            const tempContainer = document.createElement('div');
            tempContainer.innerHTML = marked.parse(optimizedMarkdown.replace(/---/g, '<hr/>'));
            
            const addText = (text, options) => {
                doc.setFont(options.font || 'Helvetica', options.style || 'normal');
                doc.setFontSize(options.size || 10);
                
                const lines = doc.splitTextToSize(text, contentWidth - (options.indent || 0));
                const textHeight = lines.length * doc.internal.getLineHeight() / doc.internal.scaleFactor;

                if (cursorY + textHeight > doc.internal.pageSize.getHeight() - margin) {
                    doc.addPage();
                    cursorY = margin;
                }

                doc.text(lines, margin + (options.indent || 0), cursorY, {
                   lineHeightFactor: 1.5
                });
                
                cursorY += (lines.length * doc.getLineHeight()) + (options.spacing || 5);
            };

            const elements = Array.from(tempContainer.childNodes);

            elements.forEach(el => {
                const tagName = el.tagName || '';
                const textContent = (el.textContent || '').trim();

                if(!textContent && tagName !== 'HR') return;

                switch(tagName) {
                    case 'H1':
                        addText(textContent, { size: 18, style: 'bold', spacing: 12 });
                        break;
                    case 'H2':
                        addText(textContent, { size: 14, style: 'bold', spacing: 10 });
                        break;
                    case 'H3':
                        addText(textContent, { size: 12, style: 'bold', spacing: 8 });
                        break;
                    case 'P':
                        addText(textContent, { size: 10, style: 'normal', spacing: 8 });
                        break;
                    case 'UL':
                        Array.from(el.getElementsByTagName('li')).forEach(li => {
                            addText(`‚Ä¢ ${li.textContent.trim()}`, { size: 10, indent: 15, spacing: 4 });
                        });
                        cursorY += 8;
                        break;
                    case 'HR':
                        if (cursorY + 15 > doc.internal.pageSize.getHeight() - margin) {
                           doc.addPage();
                           cursorY = margin;
                        }
                        doc.setDrawColor(200, 200, 200);
                        doc.line(margin, cursorY, pageWidth - margin, cursorY);
                        cursorY += 15;
                        break;
                    default:
                        if (textContent) {
                            addText(textContent, { size: 10 });
                        }
                }
            });

            doc.save('curriculo-otimizado.pdf');
        }
        
        /**
         * [MODIFICADO] Selects and builds the correct prompt for the desired feature.
         * Added new prompts for 'pitch' and 'star'.
         */
        function getPrompt(type, markdown = '') {
            const jobDesc = jobDescriptionInput.value;
            const originalResume = resumeText;
            
            const baseOptimizePrompt = `[Persona] Aja como um Estrategista de Carreira e Redator de Curr√≠culos especialista em otimiza√ß√£o para ATS. [Contexto] Reescreva o curr√≠culo para maximizar a compatibilidade com a vaga. [Entradas] \nDescri√ß√£o da Vaga: \n\`\`\`${jobDesc}\`\`\`\n\nTexto do Curr√≠culo Atual:\n\`\`\`${originalResume}\`\`\`\n\n[Instru√ß√µes] Analise a vaga, identifique palavras-chave, e reescreva o curr√≠culo se√ß√£o por se√ß√£o. [Formato da Sa√≠da] Produza o curr√≠culo final em formato Markdown limpo e de coluna √∫nica. Use --- para separar se√ß√µes. [Restri√ß√£o CR√çTICA] O resultado DEVE come√ßar diretamente com o conte√∫do do curr√≠culo. N√ÉO inclua nenhuma frase introdut√≥ria ou coment√°rio.`;
            
            switch (type) {
                case 'optimize':
                    return baseOptimizePrompt;
                case 'analyze':
                    return `[Persona] Coach de Carreira anal√≠tico. [Contexto] Analisar curr√≠culo otimizado contra a vaga. [Entradas]\nDescri√ß√£o da Vaga:\n\`\`\`${jobDesc}\`\`\`\n\nCurr√≠culo Otimizado (Markdown):\n\`\`\`${markdown}\`\`\`\n\n[Instru√ß√µes] Forne√ßa uma an√°lise em duas se√ß√µes: "Pontos Fortes" e "Pontos a Melhorar". Seja construtivo e direto. [Formato da Sa√≠da] Markdown com cabe√ßalhos.`;
                case 'questions':
                    return `[Persona] Gerente de Contrata√ß√£o experiente. [Contexto] Preparar para entrevista. [Entradas]\nDescri√ß√£o da Vaga:\n\`\`\`${jobDesc}\`\`\`\n\nCurr√≠culo do Candidato (Markdown):\n\`\`\`${markdown}\`\`\`\n\n[Instru√ß√µes] Crie duas listas: "Perguntas que o Entrevistador Pode Fazer" e "Perguntas Inteligentes para Voc√™ Fazer". [Formato da Sa√≠da] Markdown com cabe√ßalhos.`;
                case 'coverLetter':
                    return `[Persona] Redator Profissional. [Contexto] Escrever uma carta de apresenta√ß√£o. [Entradas]\nDescri√ß√£o da Vaga:\n\`\`\`${jobDesc}\`\`\`\n\nCurr√≠culo do Candidato (Markdown):\n\`\`\`${markdown}\`\`\`\n\n[Instru√ß√µes] Escreva um rascunho de carta de apresenta√ß√£o profissional de 3 par√°grafos. [Formato da Sa√≠da] Markdown.`;
                case 'linkedin':
                    return `[Persona] Especialista em Marca Pessoal e LinkedIn. [Contexto] Otimizar um perfil do LinkedIn. [Entradas]\nDescri√ß√£o da Vaga:\n\`\`\`${jobDesc}\`\`\`\n\nCurr√≠culo Otimizado (Markdown):\n\`\`\`${markdown}\`\`\`\n\n[Instru√ß√µes] Gere 3 se√ß√µes: 'T√≠tulo Profissional (Headline)', 'Se√ß√£o "Sobre"', e 'Principais Compet√™ncias'. [Formato da Sa√≠da] Markdown com cabe√ßalhos.`;
                case 'followup':
                    return `[Persona] Coach de Carreira. [Contexto] Escrever e-mail de agradecimento p√≥s-entrevista. [Entradas]\nDescri√ß√£o da Vaga:\n\`\`\`${jobDesc}\`\`\`\n\n[Instru√ß√µes] Crie um rascunho de e-mail de agradecimento. Use placeholders como '[Nome do Entrevistador]' e '[Seu Nome]'. O e-mail deve ter assunto claro, agradecer, reiterar interesse, e mencionar um ponto positivo da conversa. [Formato da Sa√≠da] Texto formatado como e-mail.`;
                case 'pitch':
                    return `[Persona] Coach de Carreira especialista em entrevistas. [Contexto] Criar um "pitch" para a pergunta "Fale sobre voc√™". [Entradas]\nDescri√ß√£o da Vaga:\n\`\`\`${jobDesc}\`\`\`\n\nCurr√≠culo Otimizado (Markdown):\n\`\`\`${markdown}\`\`\`\n\n[Instru√ß√µes] Crie um pitch pessoal de 3 par√°grafos (m√°ximo de 150 palavras). 1¬∫ par√°grafo: Apresenta√ß√£o (profiss√£o, anos de experi√™ncia). 2¬∫ par√°grafo: Conecte suas habilidades e uma conquista chave do curr√≠culo aos requisitos da vaga. 3¬∫ par√°grafo: Expresse entusiasmo pela vaga e o que espera alcan√ßar. [Formato da Sa√≠da] Markdown.`;                case 'star':
                    return `[Persona] Coach de Entrevistas Comportamentais. [Contexto] Estruturar experi√™ncias usando o m√©todo STAR (Situa√ß√£o, Tarefa, A√ß√£o, Resultado). [Entradas]\nDescri√ß√£o da Vaga:\n\`\`\`${jobDesc}\`\`\`\n\nCurr√≠culo Otimizado (Markdown):\n\`\`\`${markdown}\`\`\`\n\n[Instru√ß√µes] Selecione as 2 experi√™ncias profissionais mais relevantes do curr√≠culo. Para cada uma, estruture-a no formato STAR: **Situa√ß√£o:** (O contexto/desafio), **Tarefa:** (Sua responsabilidade), **A√ß√£o:** (O que voc√™ fez), **Resultado:** (O impacto quantificado). [Formato da Sa√≠da] Markdown com cabe√ßalhos claros para cada hist√≥ria e para S, T, A, R.`;
                case 'salary':
                    return `[Persona] Consultor de Remunera√ß√£o e Analista de Mercado de Trabalho. [Contexto] Calcular pretens√£o salarial adequada para a vaga. [Entradas]\nDescri√ß√£o da Vaga:\n\`\`\`${jobDesc}\`\`\`\n\nCurr√≠culo Otimizado (Markdown):\n\`\`\`${markdown}\`\`\`\n\n[Instru√ß√µes] Analise o n√≠vel da vaga, responsabilidades, experi√™ncia exigida e as compet√™ncias do candidato. Forne√ßa uma faixa salarial (valor m√≠nimo e m√°ximo) em reais brasileiros, considerando o mercado atual. Inclua: 1) **An√°lise da Vaga:** Senioridade, setor e localiza√ß√£o inferida; 2) **An√°lise do Perfil:** Experi√™ncia e compet√™ncias do candidato; 3) **Faixa Salarial Sugerida:** Valor m√≠nimo e m√°ximo com justificativa; 4) **Dicas de Negocia√ß√£o:** Como apresentar a pretens√£o salarial. [Formato da Sa√≠da] Markdown com se√ß√µes claras.`;
                default:
                    return '';
            }
        }

        // --- UI Helper Functions ---

        function toggleMainLoader(isLoading) {
            generateButton.disabled = isLoading;
            loader.classList.toggle('hidden', !isLoading);
            buttonText.textContent = isLoading ? 'Gerando...' : 'Gerar Curr√≠culo Otimizado';
        }
        
        function toggleFeatureLoader(button, isLoading) {
            button.disabled = isLoading;
            if (isLoading) {
                button.innerHTML = `<div class="feature-loader"></div>`;
            } else {
                button.innerHTML = button.getAttribute('data-original-text');
            }
        }

        function enableFeatureButtons(isEnabled) {
            Object.keys(featureButtons).forEach(key => {
                const btn = featureButtons[key];
                btn.disabled = !isEnabled;
                
                let currentClasses = btn.className;
                currentClasses = currentClasses.replace(enabledBtnClasses, '').replace(disabledBtnClasses, '').trim();
                btn.className = `${currentClasses} ${isEnabled ? enabledBtnClasses : disabledBtnClasses}`;
                
                if(isEnabled) {
                    btn.setAttribute('data-original-text', btn.innerHTML);
                }
            });
        }
        
        function showError(title, message) {
            errorModalTitle.textContent = title;
            errorModalMessage.textContent = message;
            errorModal.classList.remove('hidden');
        }
        
        function showContentModal(title, markdownContent) {
            contentModalTitle.textContent = title;
            contentModalBody.innerHTML = marked.parse(markdownContent);
            contentModal.classList.remove('hidden');
        }
    </script>
</body>
</html>