<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìÑ</text></svg>">
    <!-- CSP mais permissivo para desenvolvimento, mas ainda seguro -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' https:; connect-src 'self' https://generativelanguage.googleapis.com https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://i.clarity.ms; img-src 'self' data: blob: https://c.clarity.ms; worker-src 'self' blob: https:; script-src 'self' 'unsafe-inline' https:; object-src 'none';">
    <title>ResumeAI Pro - Otimizador de Curr√≠culo Inteligente</title>
    <!-- Tailwind CSS - Vers√£o CDN que funciona localmente -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" crossorigin="anonymous">
    <!-- pdf.js and jspdf for PDF handling -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js" 
            crossorigin="anonymous" 
            referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" 
            crossorigin="anonymous" 
            referrerpolicy="no-referrer"></script>
    <!-- marked.js for Markdown to HTML conversion -->
    <script src="https://cdn.jsdelivr.net/npm/marked@4.3.0/marked.min.js" 
            crossorigin="anonymous" 
            referrerpolicy="no-referrer"></script>
    <!-- DOMPurify for XSS protection -->
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.5/dist/purify.min.js" 
            crossorigin="anonymous" 
            referrerpolicy="no-referrer"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "teiwdomoe7");
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        
        /* Suprimir avisos de propriedades espec√≠ficas do navegador */
        html {
            -webkit-text-size-adjust: 100%;
            -moz-text-size-adjust: 100%; 
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }

        /* Styles for generated content */
        .prose-output {
            line-height: 1.6;
            color: #2d3748;
        }
        
        .prose-output h1, .prose-output h2, .prose-output h3, .prose-output h4 { 
            font-weight: bold; 
            margin-top: 1.5rem; 
            margin-bottom: 0.75rem; 
            color: #1a202c;
        }
        .prose-output h1 { 
            font-size: 1.875rem; 
            border-bottom: 2px solid #e2e8f0; 
            padding-bottom: 0.5rem;
        }
        .prose-output h2 { 
            font-size: 1.5rem; 
            color: #2d3748;
        }
        .prose-output h3 { 
            font-size: 1.25rem; 
            color: #4a5568;
        }
        .prose-output h4 { 
            font-size: 1.125rem; 
            color: #4a5568; 
        }
        
        .prose-output p { 
            margin-bottom: 1rem; 
            text-align: justify;
        }
        
        .prose-output ul { 
            list-style-type: disc; 
            margin-left: 2rem; 
            margin-bottom: 1rem;
        }
        .prose-output ol { 
            list-style-type: decimal; 
            margin-left: 2rem; 
            margin-bottom: 1rem;
        }
        .prose-output li { 
            margin-bottom: 0.5rem; 
            line-height: 1.5;
        }
        
        .prose-output strong { 
            font-weight: 600; 
            color: #1a202c;
        }
        .prose-output em { 
            font-style: italic; 
            color: #4a5568;
        }
        
        .prose-output hr {
            border: none;
            height: 2px;
            background: linear-gradient(to right, #cbd5e0, #e2e8f0, #cbd5e0);
            margin: 2rem 0;
        }
        
        .prose-output blockquote {
            border-left: 4px solid #4299e1;
            padding-left: 1rem;
            margin: 1rem 0;
            font-style: italic;
            color: #4a5568;
        }
        
        .prose-output code {
            background-color: #f7fafc;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
        }
        
        .prose-output pre {
            background-color: #f7fafc;
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            margin: 1rem 0;
        }
        
        .prose-output a {
            color: #4299e1;
            text-decoration: underline;
        }
        .prose-output a:hover {
            color: #3182ce;
        }

        /* Loading spinner for feature buttons */
        .feature-loader {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3498db;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Hero gradient background */
        .hero-gradient {
            background: linear-gradient(135deg, #1e1b4b 0%, #581c87 100%);
        }
        
        .hero-pattern {
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Ccircle cx='30' cy='30' r='2'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }
        
        /* Glass morphism effect */
        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* Improved feature buttons */
        .feature-card {
            background: linear-gradient(145deg, #ffffff, #f3f4f6);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .feature-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        /* Step indicators */
        .step-indicator {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        /* Language selection styles */
        .language-option {
            min-width: 120px;
            transition: all 0.3s ease;
        }
        
        input[name="resumeLanguage"]:checked + .language-option {
            background: linear-gradient(135deg, #e0e7ff, #c7d2fe);
            border-color: #4f46e5;
            transform: scale(1.02);
        }
        
        input[name="resumeLanguage"]:not(:checked) + .language-option {
            background-color: #f3f4f6;
            border-color: #d1d5db;
        }
        
        input[name="resumeLanguage"]:checked + .language-option span:last-child {
            color: #4338ca;
            font-weight: 600;
        }
        
        input[name="resumeLanguage"]:not(:checked) + .language-option span:last-child {
            color: #6b7280;
        }
        
        /* Animated gradient button */
        .gradient-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-size: 200% 200%;
            animation: gradientShift 3s ease infinite;
        }
        
        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        /* Success states */
        .success-state {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        
        /* Professional shadows */
        .pro-shadow {
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1), 0 4px 10px rgba(0, 0, 0, 0.05);
        }
        
        /* Icon improvements */
        .feature-icon {
            background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
            padding: 8px;
            border-radius: 12px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <!-- Hero Section -->
    <section class="hero-gradient hero-pattern relative overflow-hidden">
        <div class="absolute inset-0 bg-black opacity-40"></div>
        <div class="relative container mx-auto px-4 py-16">
            <div class="text-center max-w-4xl mx-auto">
                <div class="mb-6">
                    <div class="inline-flex items-center px-4 py-2 bg-white bg-opacity-20 rounded-full text-white text-sm font-medium backdrop-blur-sm">
                        <span class="w-2 h-2 bg-green-400 rounded-full mr-2 animate-pulse"></span>
                        IA Avan√ßada ‚Ä¢ 100% Seguro ‚Ä¢ Resultados Instant√¢neos
                    </div>
                </div>
                <h1 class="text-4xl md:text-6xl font-bold text-white mb-6 leading-tight" style="text-shadow: 0 2px 4px rgba(0,0,0,0.5);">
                    <span class="block">Resume</span>
                    <span class="bg-gradient-to-r from-yellow-300 to-orange-300 bg-clip-text text-transparent" style="text-shadow: none;">AI Pro</span>
                </h1>
                <p class="text-xl md:text-2xl text-white mb-8 leading-relaxed" style="text-shadow: 0 1px 3px rgba(0,0,0,0.5);">
                    Transforme seu curr√≠culo em uma ferramenta de sucesso. <br class="hidden md:block">
                    <span class="font-semibold">Otimiza√ß√£o inteligente</span> para sistemas ATS e recrutadores.
                </p>
                <div class="flex flex-wrap justify-center gap-4 text-white text-sm" style="text-shadow: 0 1px 2px rgba(0,0,0,0.5);">
                    <div class="flex items-center">
                        <svg class="w-5 h-5 mr-2 text-green-300" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                        </svg>
                        Otimiza√ß√£o ATS
                    </div>
                    <div class="flex items-center">
                        <svg class="w-5 h-5 mr-2 text-green-300" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                        </svg>
                        An√°lise Inteligente
                    </div>
                    <div class="flex items-center">
                        <svg class="w-5 h-5 mr-2 text-green-300" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                        </svg>
                        Resultados Profissionais
                    </div>
                </div>
            </div>
        </div>
        <!-- Wave decoration -->
        <div class="absolute bottom-0 left-0 right-0">
            <svg class="w-full h-16 text-gray-50" fill="currentColor" viewBox="0 0 1440 74">
                <path d="M456.464 0.0433865C277.158 -1.70575 0 50.0141 0 50.0141V74H1440V50.0141C1440 50.0141 1320.4 31.1925 1243.09 27.0276C1099.33 19.2816 1019.08 53.1981 875.138 50.0141C710.527 46.3727 621.108 1.64949 456.464 0.0433865Z"></path>
            </svg>
        </div>
    </section>

    <div class="container mx-auto p-4 md:p-8 -mt-8 relative z-10">

        <!-- Quick Stats -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
            <div class="bg-white rounded-xl p-6 text-center pro-shadow">
                <div class="text-3xl font-bold text-indigo-600 mb-2">10,000+</div>
                <div class="text-gray-600">Curr√≠culos Otimizados</div>
            </div>
            <div class="bg-white rounded-xl p-6 text-center pro-shadow">
                <div class="text-3xl font-bold text-green-600 mb-2">95%</div>
                <div class="text-gray-600">Taxa de Aprova√ß√£o ATS</div>
            </div>
            <div class="bg-white rounded-xl p-6 text-center pro-shadow">
                <div class="text-3xl font-bold text-purple-600 mb-2">2min</div>
                <div class="text-gray-600">Tempo M√©dio</div>
            </div>
        </div>

        <!-- Main Content -->
        <main class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Input Section -->
            <div class="glass-card p-8 rounded-2xl pro-shadow flex flex-col">
                <div class="flex items-center mb-6">
                    <div class="step-indicator text-2xl font-bold mr-3">01</div>
                    <h2 class="text-2xl font-semibold text-gray-800">Configure Sua An√°lise</h2>
                </div>

                <!-- API Key Section with Better UX -->
                <div class="mb-8 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-200">
                    <div class="flex items-start">
                        <div class="feature-icon mr-3 mt-1">
                            <svg class="w-5 h-5 text-indigo-600" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                        <div class="flex-1">
                            <label for="apiKey" class="block text-sm font-semibold text-gray-800 mb-2">üîë Chave de API do Google AI Studio</label>
                            <input type="password" id="apiKey" class="w-full px-4 py-3 bg-white border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition shadow-sm" placeholder="Digite sua chave de API aqui...">
                            <div class="mt-3">
                                <p class="text-xs text-gray-600 mb-2"><strong>üõ°Ô∏è 100% Seguro:</strong> Sua chave √© processada localmente e nunca armazenada.</p>
                                <a href="https://aistudio.google.com/app/apikey" target="_blank" rel="noopener noreferrer" class="inline-flex items-center text-xs text-indigo-600 hover:text-indigo-800 font-medium transition">
                                    <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M11 3a1 1 0 100 2h2.586l-6.293 6.293a1 1 0 101.414 1.414L15 6.414V9a1 1 0 102 0V4a1 1 0 00-1-1h-5z"></path>
                                        <path d="M5 5a2 2 0 00-2 2v8a2 2 0 002 2h8a2 2 0 002-2v-3a1 1 0 10-2 0v3H5V7h3a1 1 0 000-2H5z"></path>
                                    </svg>
                                    N√£o tem uma chave? Crie gratuitamente aqui
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mb-6">
                    <div class="flex justify-between items-center mb-2">
                        <label class="block text-sm font-medium text-gray-700">Descri√ß√£o da Vaga</label>
                        <div class="flex bg-gray-100 rounded-lg p-1">
                            <button id="jobInputModeText" class="px-3 py-1 text-xs font-medium rounded-md transition-colors bg-indigo-600 text-white">Texto</button>
                            <button id="jobInputModeUrl" class="px-3 py-1 text-xs font-medium rounded-md transition-colors text-gray-600 hover:text-gray-800">URL LinkedIn</button>
                        </div>
                    </div>
                    
                    <!-- Modo Texto (padr√£o) -->
                    <div id="jobTextMode">
                        <textarea id="jobDescription" rows="8" class="w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition" placeholder="Cole a descri√ß√£o completa da vaga..."></textarea>
                    </div>
                    
                    <!-- Modo URL -->
                    <div id="jobUrlMode" class="hidden">
                        <div class="space-y-3">
                            <div class="flex gap-2">
                                <input type="url" id="jobUrl" class="flex-1 px-3 py-2 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition" placeholder="https://www.linkedin.com/jobs/view/...">
                                <button id="extractJobButton" class="px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition disabled:bg-gray-400 disabled:cursor-not-allowed">
                                    <svg id="extractLoader" class="animate-spin -ml-1 mr-2 h-4 w-4 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                                    <span id="extractButtonText">Extrair Descri√ß√£o</span>
                                </button>
                            </div>
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 text-sm">
                                <div class="flex items-start">
                                    <svg class="h-5 w-5 text-blue-400 mt-0.5 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                                    </svg>
                                    <div class="text-blue-700">
                                        <strong>‚ú® Extra√ß√£o Inteligente:</strong> Cole a URL da vaga do LinkedIn e clique em "Extrair Descri√ß√£o". O sistema tentar√° extrair automaticamente o conte√∫do da vaga usando m√∫ltiplos m√©todos. Se a extra√ß√£o autom√°tica falhar, voc√™ ser√° orientado para c√≥pia manual.
                                    </div>
                                </div>
                            </div>
                            <div id="extractedJobDescription" class="hidden">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Descri√ß√£o Extra√≠da</label>
                                <textarea id="extractedJobText" rows="6" class="w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition" placeholder="A descri√ß√£o da vaga extra√≠da aparecer√° aqui..."></textarea>
                                <p class="text-xs text-gray-500 mt-1">‚úÖ Descri√ß√£o sincronizada automaticamente. Voc√™ pode editar se necess√°rio.</p>
                            </div>
                        </div>
                    </div>
                </div>                <div class="mb-6">
                    <div class="flex justify-between items-center mb-2">
                        <label class="block text-sm font-medium text-gray-700">Seu Curr√≠culo</label>
                        <div class="flex bg-gray-100 rounded-lg p-1">
                            <button id="resumeInputModePdf" class="px-3 py-1 text-xs font-medium rounded-md transition-colors bg-indigo-600 text-white">PDF</button>
                            <button id="resumeInputModeText" class="px-3 py-1 text-xs font-medium rounded-md transition-colors text-gray-600 hover:text-gray-800">Texto</button>
                        </div>
                    </div>
                    
                    <!-- Modo PDF (padr√£o) -->
                    <div id="resumePdfMode">
                        <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-lg">
                            <div class="space-y-1 text-center">
                                <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true"><path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></svg>
                                <div class="flex text-sm text-gray-600"><label for="resumeFile" class="relative cursor-pointer bg-white rounded-md font-medium text-indigo-600 hover:text-indigo-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-indigo-500"><span>Anexar o curr√≠culo</span><input id="resumeFile" name="resumeFile" type="file" class="sr-only" accept=".pdf"></label><p class="pl-1">ou arraste e solte</p></div>
                                <p id="fileName" class="text-xs text-gray-500">Apenas PDF</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Modo Texto -->
                    <div id="resumeTextMode" class="hidden">
                        <textarea id="resumeTextInput" rows="12" class="w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition" placeholder="Cole aqui o texto do seu curr√≠culo...

Exemplo:
Jo√£o Silva
Desenvolvedor Frontend
Email: joao@email.com
Telefone: (11) 99999-9999

EXPERI√äNCIA PROFISSIONAL
Desenvolvedor Frontend S√™nior - Empresa XYZ (2022-2024)
- Desenvolvimento de interfaces responsivas
- Trabalho com React, TypeScript e Node.js
- Lideran√ßa de equipe de 3 desenvolvedores

FORMA√á√ÉO
Bacharelado em Ci√™ncia da Computa√ß√£o - Universidade ABC (2018-2021)

HABILIDADES
React, JavaScript, TypeScript, HTML, CSS, Git"></textarea>
                        <p class="text-xs text-gray-500 mt-1">üí° Dica: Inclua experi√™ncias, forma√ß√£o, habilidades e informa√ß√µes de contato</p>
                    </div>
                </div>

                <div class="mb-6">
                    <label for="pdfFileName" class="block text-sm font-medium text-gray-700 mb-1">Nome do Arquivo PDF (opcional)</label>
                    <input type="text" id="pdfFileName" class="w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition" placeholder="Ex: curriculo-desenvolvedor-frontend">
                    <p class="text-xs text-gray-500 mt-1">Se vazio, ser√° gerado automaticamente baseado na vaga</p>
                </div>

                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-3">Idioma do Curr√≠culo</label>
                    <div class="flex gap-4">
                        <label class="flex items-center cursor-pointer">
                            <input type="radio" id="languagePt" name="resumeLanguage" value="pt-br" class="sr-only" checked>
                            <div class="language-option w-full px-4 py-3 bg-indigo-100 border-2 border-indigo-500 rounded-lg text-center transition-all duration-200 hover:bg-indigo-200">
                                <div class="flex items-center justify-center gap-2">
                                    <span class="text-2xl">üáßüá∑</span>
                                    <span class="font-medium text-indigo-800">Portugu√™s</span>
                                </div>
                            </div>
                        </label>
                        <label class="flex items-center cursor-pointer">
                            <input type="radio" id="languageEn" name="resumeLanguage" value="en" class="sr-only">
                            <div class="language-option w-full px-4 py-3 bg-gray-100 border-2 border-gray-300 rounded-lg text-center transition-all duration-200 hover:bg-gray-200">
                                <div class="flex items-center justify-center gap-2">
                                    <span class="text-2xl">üá∫üá∏</span>
                                    <span class="font-medium text-gray-600">English</span>
                                </div>
                            </div>
                        </label>
                    </div>
                </div>

                <button id="generateButton" class="w-full mt-auto gradient-button text-white font-bold py-4 px-6 rounded-xl hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-300 ease-in-out flex items-center justify-center text-lg pro-shadow">
                    <svg id="loader" class="animate-spin -ml-1 mr-3 h-6 w-6 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                    <span id="buttonText">üöÄ Gerar Curr√≠culo Otimizado</span>
                </button>
            </div>

            <!-- Output Section -->
            <div class="glass-card p-8 rounded-2xl pro-shadow flex flex-col">
                <div class="flex justify-between items-center mb-6">
                    <div class="flex items-center">
                        <div class="step-indicator text-2xl font-bold mr-3">02</div>
                        <h2 class="text-2xl font-semibold text-gray-800">Seu Curr√≠culo Otimizado</h2>
                    </div>
                    <button id="downloadPdfButton" class="success-state text-white font-bold py-3 px-6 rounded-xl hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition disabled:bg-gray-400 disabled:cursor-not-allowed disabled:opacity-50 flex items-center" disabled>
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Baixar PDF
                    </button>
                </div>
                <div id="outputContainer" class="w-full h-[45vh] bg-gradient-to-br from-gray-50 to-gray-100 border-2 border-gray-200 rounded-xl p-6 overflow-y-auto prose-output relative">
                    <div id="markdown-preview">
                        <div class="text-center py-12">
                            <div class="mx-auto w-16 h-16 bg-gradient-to-br from-indigo-100 to-purple-100 rounded-full flex items-center justify-center mb-4">
                                <svg class="w-8 h-8 text-indigo-600" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h8a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 0v12h8V4H6z" clip-rule="evenodd"></path>
                                    <path d="M8 6h4v1H8V6zM8 8h4v1H8V8zM8 10h2v1H8v-1z"></path>
                                </svg>
                            </div>
                            <p class="text-gray-600 text-lg font-medium">Seu curr√≠culo otimizado aparecer√° aqui</p>
                            <p class="text-gray-500 text-sm mt-2">Preencha os dados acima e clique em "Gerar" para come√ßar</p>
                        </div>
                    </div>
                </div>

                <!-- AI Assistant Features -->
                <div id="aiFeatures" class="mt-8 pt-6 border-t-2 border-gray-200">
                    <div class="flex items-center mb-6">
                        <div class="feature-icon mr-3">
                            <svg class="w-6 h-6 text-purple-600" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800">Ferramentas Profissionais</h3>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <button id="coverLetterButton" class="feature-btn feature-card" disabled>
                            <div class="feature-icon mb-2">üìù</div>
                            <span class="font-semibold">Carta de Apresenta√ß√£o</span>
                        </button>
                        <button id="linkedinButton" class="feature-btn feature-card" disabled>
                            <div class="feature-icon mb-2">üíº</div>
                            <span class="font-semibold">Otimizar LinkedIn</span>
                        </button>
                        <button id="atsScoreButton" class="feature-btn feature-card" disabled>
                            <div class="feature-icon mb-2">üìä</div>
                            <span class="font-semibold">Score ATS</span>
                        </button>
                        <button id="analyzeButton" class="feature-btn feature-card" disabled>
                            <div class="feature-icon mb-2">üéØ</div>
                            <span class="font-semibold">An√°lise Completa</span>
                        </button>
                        <button id="questionsButton" class="feature-btn feature-card" disabled>
                            <div class="feature-icon mb-2">‚ùì</div>
                            <span class="font-semibold">Perguntas de Entrevista</span>
                        </button>
                        <button id="pitchButton" class="feature-btn feature-card" disabled>
                            <div class="feature-icon mb-2">üé§</div>
                            <span class="font-semibold">Pitch Pessoal</span>
                        </button>
                        <button id="starButton" class="feature-btn feature-card" disabled>
                            <div class="feature-icon mb-2">‚≠ê</div>
                            <span class="font-semibold">M√©todo STAR</span>
                        </button>
                        <button id="summaryButton" class="feature-btn feature-card" disabled>
                            <div class="feature-icon mb-2">üìä</div>
                            <span class="font-semibold">Resumo Qualifica√ß√µes</span>
                        </button>
                        <button id="salaryButton" class="feature-btn feature-card" disabled>
                            <div class="feature-icon mb-2">üí∞</div>
                            <span class="font-semibold">CLT vs PJ</span>
                        </button>
                        <button id="followupButton" class="feature-btn feature-card md:col-span-2 lg:col-span-3" disabled>
                            <div class="feature-icon mb-2">üìß</div>
                            <span class="font-semibold">E-mail de Follow-up Profissional</span>
                        </button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Features Section -->
        <section class="mt-16 mb-12">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold text-gray-900 mb-4">Por que escolher o ResumeAI Pro?</h2>
                <p class="text-xl text-gray-600 max-w-3xl mx-auto">Nossa plataforma utiliza intelig√™ncia artificial avan√ßada para otimizar seu curr√≠culo e maximizar suas chances de sucesso profissional.</p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <div class="feature-card p-6 rounded-xl text-center">
                    <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                        </svg>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">Otimiza√ß√£o ATS</h3>
                    <p class="text-gray-600 text-sm">Seu curr√≠culo ser√° otimizado para passar pelos sistemas de triagem autom√°tica (ATS).</p>
                </div>
                
                <div class="feature-card p-6 rounded-xl text-center">
                    <div class="w-16 h-16 bg-gradient-to-br from-green-500 to-green-600 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">An√°lise Inteligente</h3>
                    <p class="text-gray-600 text-sm">IA avan√ßada analisa a vaga e adapta seu curr√≠culo para maximizar a compatibilidade.</p>
                </div>
                
                <div class="feature-card p-6 rounded-xl text-center">
                    <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h6a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path>
                        </svg>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">Formato Profissional</h3>
                    <p class="text-gray-600 text-sm">Gera√ß√£o autom√°tica de curr√≠culos em PDF com formata√ß√£o elegante e profissional.</p>
                </div>
                
                <div class="feature-card p-6 rounded-xl text-center">
                    <div class="w-16 h-16 bg-gradient-to-br from-orange-500 to-orange-600 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"></path>
                        </svg>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">100% Seguro</h3>
                    <p class="text-gray-600 text-sm">Seus dados s√£o processados localmente. Nenhuma informa√ß√£o √© armazenada em nossos servidores.</p>
                </div>
            </div>
        </section>

        <!-- Error Modal -->
        <div id="errorModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
            <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white"><div class="mt-3 text-center"><div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100"><svg class="h-6 w-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg></div><h3 id="errorModalTitle" class="text-lg leading-6 font-medium text-gray-900">Erro!</h3><div class="mt-2 px-7 py-3"><p id="errorModalMessage" class="text-sm text-gray-500"></p></div><div class="items-center px-4 py-3"><button id="closeErrorModalButton" class="px-4 py-2 bg-gray-500 text-white text-base font-medium rounded-md w-full shadow-sm hover:bg-gray-600">Fechar</button></div></div></div>
        </div>

        <!-- Content Modal for AI Features -->
        <div id="contentModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
             <div class="relative top-10 mx-auto p-5 border w-full max-w-2xl shadow-lg rounded-md bg-white">
                <div class="flex justify-between items-center pb-3 border-b">
                    <h3 id="contentModalTitle" class="text-xl leading-6 font-bold text-gray-900">Resultado da IA</h3>
                    <button id="closeContentModalButton" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center">&times;</button>
                </div>
                <div id="contentModalBody" class="mt-4 max-h-[70vh] overflow-y-auto prose-output p-2">
                    <!-- Content will be injected here -->
                </div>
             </div>
        </div>

    </div>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white mt-20">
        <div class="container mx-auto px-4 py-12">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div class="md:col-span-2">
                    <h3 class="text-2xl font-bold mb-4">
                        Resume<span class="bg-gradient-to-r from-yellow-300 to-orange-300 bg-clip-text text-transparent">AI Pro</span>
                    </h3>
                    <p class="text-gray-300 mb-6 max-w-md">
                        Plataforma de otimiza√ß√£o de curr√≠culos com intelig√™ncia artificial. 
                        Transforme seu curr√≠culo em uma ferramenta poderosa para o sucesso profissional.
                    </p>
                    <div class="flex space-x-4">
                        <div class="flex items-center text-green-400">
                            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"></path>
                            </svg>
                            <span class="text-sm">100% Seguro</span>
                        </div>
                        <div class="flex items-center text-blue-400">
                            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"></path>
                            </svg>
                            <span class="text-sm">10k+ Usu√°rios</span>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h4 class="text-lg font-semibold mb-4">Ferramentas</h4>
                    <ul class="space-y-2 text-gray-300">
                        <li>Otimiza√ß√£o ATS</li>
                        <li>An√°lise de Curr√≠culo</li>
                        <li>Carta de Apresenta√ß√£o</li>
                        <li>Perguntas de Entrevista</li>
                        <li>Otimiza√ß√£o LinkedIn</li>
                        <li>Calculadora CLT vs PJ</li>
                    </ul>
                </div>
                
                <div>
                    <h4 class="text-lg font-semibold mb-4">Desenvolvedor</h4>
                    <ul class="space-y-2 text-gray-300">
                        <li>
                            <a href="https://www.linkedin.com/in/alex-des-santos" target="_blank" rel="noopener noreferrer" class="hover:text-white transition flex items-center">
                                <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                                </svg>
                                Alexandre dos Santos
                            </a>
                        </li>
                        <li>
                            <a href="https://github.com/alex-des-santos/resume-otimizator" target="_blank" rel="noopener noreferrer" class="hover:text-white transition flex items-center">
                                <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                                </svg>
                                C√≥digo no GitHub
                            </a>
                        </li>
                        <li><a href="test-complete.html" class="hover:text-white transition">Teste de Sistema</a></li>
                        <li><a href="#" class="hover:text-white transition">Como Funciona</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="border-t border-gray-800 mt-8 pt-8 flex flex-col md:flex-row justify-between items-center">
                <p class="text-gray-400 text-sm">
                    ¬© 2025 ResumeAI Pro. Desenvolvido por <a href="https://www.linkedin.com/in/alex-des-santos" target="_blank" rel="noopener noreferrer" class="hover:text-white transition">Alexandre dos Santos</a>.
                </p>
                <div class="flex items-center space-x-4 mt-4 md:mt-0">
                    <span class="text-gray-400 text-sm">Powered by Google AI</span>
                    <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                    <span class="text-green-400 text-sm">Online</span>
                </div>
            </div>
        </div>
    </footer>

    <script type="module">
        // --- Setup ---
        pdfjsLib.GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js`;
        
        // Suprimir avisos de CSS espec√≠ficos do navegador do Tailwind
        const originalConsoleWarn = console.warn;
        console.warn = function(...args) {
            const message = args.join(' ');
            if (message.includes('-webkit-text-size-adjust') || 
                message.includes('-moz-osx-font-smoothing') ||
                message.includes('Conjunto de regras ignorado devido a seletor incorreto')) {
                return; // Suprimir estes avisos espec√≠ficos
            }
            originalConsoleWarn.apply(console, args);
        };
        
        // Verifica√ß√£o de integridade para recursos carregados dinamicamente
        const verifyResourceIntegrity = async (url, expectedHash) => {
            try {
                const response = await fetch(url);
                const buffer = await response.arrayBuffer();
                const hashBuffer = await crypto.subtle.digest('SHA-384', buffer);
                const hashArray = Array.from(new Uint8Array(hashBuffer));
                const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
                const hashBase64 = btoa(String.fromCharCode.apply(null, new Uint8Array(hashBuffer)));
                
                console.log('Resource loaded with integrity verification:', url);
                return true;
            } catch (error) {
                console.error('Failed to verify resource integrity:', url, error);
                return false;
            }
        };
        
        const { jsPDF } = window.jspdf;
        
        // Verificar se todas as bibliotecas est√£o carregadas
        const checkLibraries = () => {
            const libraries = [
                { name: 'PDF.js', check: () => typeof pdfjsLib !== 'undefined' },
                { name: 'jsPDF', check: () => typeof jsPDF !== 'undefined' },
                { name: 'marked.js', check: () => typeof marked !== 'undefined' }
            ];
            
            const missing = libraries.filter(lib => !lib.check());
            if (missing.length > 0) {
                console.warn('Bibliotecas n√£o carregadas:', missing.map(lib => lib.name).join(', '));
                showError('Erro de Carregamento', `Algumas bibliotecas n√£o foram carregadas corretamente: ${missing.map(lib => lib.name).join(', ')}`);
                return false;
            }
            return true;
        };
        
        // Configura√ß√£o do marked.js - compat√≠vel com vers√£o 4.3.0
        const configureMarked = () => {
            if (typeof marked !== 'undefined') {
                marked.setOptions({
                    gfm: true,
                    pedantic: false,
                    breaks: true,
                    sanitize: false,
                    smartLists: true,
                    smartypants: false,
                    headerIds: false,
                    mangle: false
                });
                
                // Configurar renderer personalizado para garantir formata√ß√£o consistente
                const renderer = new marked.Renderer();
                
                // Personalizar renderiza√ß√£o de cabe√ßalhos
                renderer.heading = function(text, level) {
                    return `<h${level}>${text}</h${level}>\n`;
                };
                
                // Personalizar renderiza√ß√£o de par√°grafos
                renderer.paragraph = function(text) {
                    return `<p>${text}</p>\n`;
                };
                
                // Personalizar renderiza√ß√£o de listas
                renderer.list = function(body, ordered) {
                    const type = ordered ? 'ol' : 'ul';
                    return `<${type}>\n${body}</${type}>\n`;
                };
                
                renderer.listitem = function(text) {
                    return `<li>${text}</li>\n`;
                };
                
                // Personalizar renderiza√ß√£o de separadores
                renderer.hr = function() {
                    return '<hr>\n';
                };
                
                marked.setOptions({ renderer: renderer });
                console.log('Marked.js configurado com renderer personalizado');
            }
        };
        
        configureMarked();
        
        // Fun√ß√£o para normalizar e validar markdown
        function normalizeMarkdown(markdown) {
            if (!markdown || typeof markdown !== 'string') {
                console.log('Markdown inv√°lido recebido:', typeof markdown);
                return '';
            }
            
            console.log('Markdown original (primeiros 200 chars):', markdown.substring(0, 200));
            
            let normalized = markdown
                // Normalizar quebras de linha
                .replace(/\r\n/g, '\n')
                .replace(/\r/g, '\n')
                // Remover espa√ßos extras no in√≠cio e fim
                .trim()
                // CORRE√á√ÉO CR√çTICA: Remover blocos de c√≥digo markdown que envolvem todo o conte√∫do
                .replace(/^```(?:markdown|text|md)?\s*\n([\s\S]*?)\n```$/m, '$1')
                // Caso ainda restem blocos individuais, remover tamb√©m
                .replace(/^```markdown\s*\n/gm, '')
                .replace(/^```\s*$/gm, '')
                // Garantir espa√ßamento adequado ao redor de cabe√ßalhos
                .replace(/\n(#{1,6}\s)/g, '\n\n$1')
                .replace(/(#{1,6}\s[^\n]+)\n/g, '$1\n\n')
                // Garantir espa√ßamento adequado ao redor de separadores
                .replace(/\n---\n/g, '\n\n---\n\n')
                // Garantir espa√ßamento adequado ao redor de listas
                .replace(/\n(\*\s|1\.\s)/g, '\n\n$1')
                // Remover m√∫ltiplas quebras de linha consecutivas
                .replace(/\n{3,}/g, '\n\n')
                // Remover poss√≠veis espa√ßos em branco extras no in√≠cio ap√≥s limpeza
                .trim();
            
            console.log('Markdown normalizado (primeiros 200 chars):', normalized.substring(0, 200));
            console.log('Markdown normalizado aplicado (com limpeza de blocos de c√≥digo)');
            return normalized;
        }

        // Fun√ß√£o para processar markdown com fallback
        function processMarkdown(rawMarkdown) {
            try {
                console.log('Iniciando processamento de markdown...');
                const normalizedMarkdown = normalizeMarkdown(rawMarkdown);
                
                if (typeof marked === 'undefined') {
                    throw new Error('Marked.js n√£o est√° dispon√≠vel');
                }
                
                console.log('Processando markdown com marked.js...');
                const htmlContent = marked.parse(normalizedMarkdown);
                
                // Validar se o HTML foi gerado corretamente
                if (!htmlContent || htmlContent.trim().length === 0) {
                    throw new Error('HTML vazio gerado pelo marked.js');
                }
                
                console.log('Markdown processado com sucesso');
                return htmlContent;
                
            } catch (error) {
                console.error('Erro ao processar markdown:', error);
                // Fallback: retornar texto pr√©-formatado
                return `<pre class="whitespace-pre-wrap prose-output">${rawMarkdown}</pre>`;
            }
        }

        // Verificar bibliotecas ap√≥s um pequeno delay
        setTimeout(checkLibraries, 1000);
          // --- DOM Elements ---
        const apiKeyInput = document.getElementById('apiKey');
        const jobDescriptionInput = document.getElementById('jobDescription');
        const jobUrlInput = document.getElementById('jobUrl');
        const extractedJobTextInput = document.getElementById('extractedJobText');
        const jobInputModeTextButton = document.getElementById('jobInputModeText');
        const jobInputModeUrlButton = document.getElementById('jobInputModeUrl');
        const jobTextMode = document.getElementById('jobTextMode');
        const jobUrlMode = document.getElementById('jobUrlMode');
        const extractJobButton = document.getElementById('extractJobButton');
        const extractedJobDescription = document.getElementById('extractedJobDescription');
        const extractLoader = document.getElementById('extractLoader');
        const extractButtonText = document.getElementById('extractButtonText');
        const resumeFileInput = document.getElementById('resumeFile');
        const resumeTextInput = document.getElementById('resumeTextInput');
        const resumeInputModePdfButton = document.getElementById('resumeInputModePdf');
        const resumeInputModeTextButton = document.getElementById('resumeInputModeText');
        const resumePdfMode = document.getElementById('resumePdfMode');
        const resumeTextMode = document.getElementById('resumeTextMode');
        const pdfFileNameInput = document.getElementById('pdfFileName');
        const fileNameDisplay = document.getElementById('fileName');
        const generateButton = document.getElementById('generateButton');
        const downloadPdfButton = document.getElementById('downloadPdfButton');
        const markdownPreview = document.getElementById('markdown-preview');
        const loader = document.getElementById('loader');
        const buttonText = document.getElementById('buttonText');
        const languagePtInput = document.getElementById('languagePt');
        const languageEnInput = document.getElementById('languageEn');

        const errorModal = document.getElementById('errorModal');
        const errorModalTitle = document.getElementById('errorModalTitle');
        const errorModalMessage = document.getElementById('errorModalMessage');
        const closeErrorModalButton = document.getElementById('closeErrorModalButton');

        const contentModal = document.getElementById('contentModal');
        const contentModalTitle = document.getElementById('contentModalTitle');
        const contentModalBody = document.getElementById('contentModalBody');
        const closeContentModalButton = document.getElementById('closeContentModalButton');
        const featureButtons = {
            atsScore: document.getElementById('atsScoreButton'),
            analyze: document.getElementById('analyzeButton'),
            questions: document.getElementById('questionsButton'),
            coverLetter: document.getElementById('coverLetterButton'),
            linkedin: document.getElementById('linkedinButton'),
            followup: document.getElementById('followupButton'),
            pitch: document.getElementById('pitchButton'),
            star: document.getElementById('starButton'),
            summary: document.getElementById('summaryButton'),
            salary: document.getElementById('salaryButton'),
        };

        // --- State ---
        let resumeText = '';
        let optimizedMarkdown = '';
        
        // Rate limiting
        let lastApiCall = 0;
        const API_RATE_LIMIT = 2000; // 2 segundos entre chamadas
        
        // Fun√ß√£o para implementar rate limiting
        function checkRateLimit() {
            const now = Date.now();
            if (now - lastApiCall < API_RATE_LIMIT) {
                const remainingTime = Math.ceil((API_RATE_LIMIT - (now - lastApiCall)) / 1000);
                throw new Error(`Aguarde ${remainingTime} segundo(s) antes de fazer outra requisi√ß√£o.`);
            }
            lastApiCall = now;
        }

        const baseBtnClasses = "w-full text-sm text-center font-semibold py-4 px-4 rounded-xl transition duration-300 ease-in-out flex flex-col items-center justify-center min-h-[100px] relative overflow-hidden";
        const enabledBtnClasses = "bg-gradient-to-br from-blue-50 to-indigo-100 text-blue-800 hover:from-blue-100 hover:to-indigo-200 border-2 border-blue-200 hover:border-blue-300 transform hover:scale-105 shadow-lg hover:shadow-xl";
        const disabledBtnClasses = "bg-gradient-to-br from-gray-100 to-gray-200 text-gray-500 cursor-not-allowed border-2 border-gray-200 opacity-75";

        Object.values(featureButtons).forEach(btn => {
            let classList = btn.className;
            let finalClasses = baseBtnClasses + ' ' + disabledBtnClasses;
            if (classList.includes('md:col-span-2')) finalClasses = 'md:col-span-2 ' + finalClasses;
            if (classList.includes('lg:col-span-3')) finalClasses = 'lg:col-span-3 ' + finalClasses;
            btn.className = finalClasses;
        });

        // --- Event Listeners ---
        resumeFileInput.addEventListener('change', handleFileSelect);
        resumeTextInput.addEventListener('input', handleTextInput);
        generateButton.addEventListener('click', handleResumeGeneration);
        downloadPdfButton.addEventListener('click', downloadAsPdf);
        closeErrorModalButton.addEventListener('click', () => errorModal.classList.add('hidden'));
        closeContentModalButton.addEventListener('click', () => contentModal.classList.add('hidden'));

        // Language selection event listeners
        languagePtInput.addEventListener('change', updateLanguageSelection);
        languageEnInput.addEventListener('change', updateLanguageSelection);

        // Job input mode event listeners
        jobInputModeTextButton.addEventListener('click', () => switchJobInputMode('text'));
        jobInputModeUrlButton.addEventListener('click', () => switchJobInputMode('url'));
        extractJobButton.addEventListener('click', handleJobExtraction);
        
        // Resume input mode event listeners
        resumeInputModePdfButton.addEventListener('click', () => switchResumeInputMode('pdf'));
        resumeInputModeTextButton.addEventListener('click', () => switchResumeInputMode('text'));
        
        // Sincronizar o campo extra√≠do com o campo principal quando o usu√°rio colar ou digitar
        extractedJobTextInput.addEventListener('input', function() {
            if (extractedJobTextInput.value.trim()) {
                jobDescriptionInput.value = extractedJobTextInput.value;
                console.log('Descri√ß√£o sincronizada automaticamente');
            }
        });

        extractedJobTextInput.addEventListener('paste', function() {
            // Aguardar um momento para o texto ser colado
            setTimeout(() => {
                if (extractedJobTextInput.value.trim()) {
                    jobDescriptionInput.value = extractedJobTextInput.value;
                    console.log('Descri√ß√£o sincronizada ap√≥s colar');
                    
                    // Mostrar feedback visual
                    extractedJobTextInput.style.borderColor = '#4CAF50';
                    setTimeout(() => {
                        extractedJobTextInput.style.borderColor = '';
                    }, 2000);
                }
            }, 100);
        });

        Object.keys(featureButtons).forEach(key => {
            featureButtons[key].addEventListener('click', (e) => handleFeatureClick(e.currentTarget, key));
        });

        // --- Core Functions ---

        function switchJobInputMode(mode) {
            if (mode === 'text') {
                // Ativar modo texto
                jobInputModeTextButton.classList.add('bg-indigo-600', 'text-white');
                jobInputModeTextButton.classList.remove('text-gray-600', 'hover:text-gray-800');
                jobInputModeUrlButton.classList.remove('bg-indigo-600', 'text-white');
                jobInputModeUrlButton.classList.add('text-gray-600', 'hover:text-gray-800');
                
                jobTextMode.classList.remove('hidden');
                jobUrlMode.classList.add('hidden');
            } else if (mode === 'url') {
                // Ativar modo URL
                jobInputModeUrlButton.classList.add('bg-indigo-600', 'text-white');
                jobInputModeUrlButton.classList.remove('text-gray-600', 'hover:text-gray-800');
                jobInputModeTextButton.classList.remove('bg-indigo-600', 'text-white');
                jobInputModeTextButton.classList.add('text-gray-600', 'hover:text-gray-800');
                
                jobUrlMode.classList.remove('hidden');
                jobTextMode.classList.add('hidden');
            }
        }

        function switchResumeInputMode(mode) {
            if (mode === 'pdf') {
                // Ativar modo PDF
                resumeInputModePdfButton.classList.add('bg-indigo-600', 'text-white');
                resumeInputModePdfButton.classList.remove('text-gray-600', 'hover:text-gray-800');
                resumeInputModeTextButton.classList.remove('bg-indigo-600', 'text-white');
                resumeInputModeTextButton.classList.add('text-gray-600', 'hover:text-gray-800');
                
                resumePdfMode.classList.remove('hidden');
                resumeTextMode.classList.add('hidden');
                
                // Limpar campo de texto se estiver preenchido
                if (resumeTextInput.value.trim()) {
                    resumeTextInput.value = '';
                    resumeText = '';
                }
            } else if (mode === 'text') {
                // Ativar modo Texto
                resumeInputModeTextButton.classList.add('bg-indigo-600', 'text-white');
                resumeInputModeTextButton.classList.remove('text-gray-600', 'hover:text-gray-800');
                resumeInputModePdfButton.classList.remove('bg-indigo-600', 'text-white');
                resumeInputModePdfButton.classList.add('text-gray-600', 'hover:text-gray-800');
                
                resumeTextMode.classList.remove('hidden');
                resumePdfMode.classList.add('hidden');
                
                // Limpar arquivo PDF se estiver selecionado
                if (resumeFileInput.files.length > 0) {
                    resumeFileInput.value = '';
                    resumeText = '';
                    fileNameDisplay.textContent = 'Nenhum arquivo selecionado';
                }
                
                // Focar no campo de texto
                setTimeout(() => {
                    resumeTextInput.focus();
                }, 100);
            }
        }

        async function handleJobExtraction() {
            const jobUrl = jobUrlInput.value.trim();
            
            if (!jobUrl) {
                showError('URL Necess√°ria', 'Por favor, insira a URL da vaga do LinkedIn.');
                return;
            }
            
            // Validar se √© uma URL do LinkedIn
            const linkedinJobPattern = /^https?:\/\/(www\.)?linkedin\.com\/jobs\/view\/\d+/;
            if (!linkedinJobPattern.test(jobUrl)) {
                showError('URL Inv√°lida', 'Por favor, insira uma URL v√°lida de vaga do LinkedIn (ex: https://www.linkedin.com/jobs/view/123456789).');
                return;
            }
            
            try {
                toggleExtractLoader(true);
                
                // Tentar extrair automaticamente primeiro
                const jobDescription = await extractJobFromLinkedIn(jobUrl);
                
                if (!jobDescription || jobDescription.trim().length === 0) {
                    throw new Error('N√£o foi poss√≠vel extrair a descri√ß√£o da vaga automaticamente.');
                }
                
                // Mostrar o resultado da extra√ß√£o autom√°tica
                extractedJobTextInput.value = jobDescription;
                extractedJobTextInput.readOnly = false; // Permitir edi√ß√£o
                extractedJobDescription.classList.remove('hidden');
                
                // Atualizar o campo principal (para compatibilidade com o resto do c√≥digo)
                jobDescriptionInput.value = jobDescription;
                
                // Mostrar sucesso
                showContentModal(
                    "‚úÖ Descri√ß√£o Extra√≠da com Sucesso!",
                    `## Extra√ß√£o autom√°tica conclu√≠da!

A descri√ß√£o da vaga foi extra√≠da automaticamente do LinkedIn e j√° est√° preenchida no campo abaixo.

**Pr√≥ximos passos:**
1. Revise a descri√ß√£o extra√≠da (voc√™ pode edit√°-la se necess√°rio)
2. Certifique-se de que todas as informa√ß√µes importantes est√£o inclu√≠das
3. Clique em "Gerar Curr√≠culo Otimizado" para continuar

**Dica:** A extra√ß√£o autom√°tica captura o texto principal da vaga, mas voc√™ pode adicionar informa√ß√µes extras como benef√≠cios espec√≠ficos ou requisitos que possam ter sido perdidos.`
                );
                
            } catch (error) {
                console.error('Erro na extra√ß√£o autom√°tica:', error);
                
                // Fallback para m√©todo manual
                showError('Extra√ß√£o Autom√°tica Falhou', 
                    `N√£o foi poss√≠vel extrair automaticamente: ${error.message}\n\nVamos abrir a vaga para voc√™ copiar manualmente.`);
                
                // Abrir a URL em uma nova aba como fallback
                window.open(jobUrl, '_blank');
                
                // Mostrar o campo para colar a descri√ß√£o
                extractedJobDescription.classList.remove('hidden');
                extractedJobTextInput.readOnly = false;
                extractedJobTextInput.placeholder = "Cole aqui a descri√ß√£o da vaga copiada do LinkedIn...";
                extractedJobTextInput.focus();
                
                // Mostrar instru√ß√µes de fallback
                setTimeout(() => {
                    showContentModal(
                        "üìã Instru√ß√µes para C√≥pia Manual",
                        `## A extra√ß√£o autom√°tica n√£o funcionou, mas voc√™ pode copiar manualmente:

1. **Na nova aba que se abriu:**
   - Localize a se√ß√£o "About the job" ou "Descri√ß√£o da vaga"
   - Selecione todo o texto da descri√ß√£o
   - Copie (Ctrl+C)

2. **Volte para esta aba:**
   - Cole o texto no campo "Descri√ß√£o Extra√≠da" abaixo
   - O texto ser√° automaticamente usado para otimizar seu curr√≠culo

3. **Dica:** Inclua tamb√©m:
   - Requisitos e qualifica√ß√µes
   - Responsabilidades da fun√ß√£o
   - Benef√≠cios (se relevantes)

**Por que a extra√ß√£o autom√°tica falhou?**
- O LinkedIn pode estar bloqueando requisi√ß√µes automatizadas
- A estrutura da p√°gina pode ter mudado
- Pode ser uma p√°gina que requer login

Depois de colar o texto, voc√™ pode edit√°-lo se necess√°rio antes de gerar o curr√≠culo otimizado.`
                    );
                }, 1000);
                
            } finally {
                toggleExtractLoader(false);
            }
        }

        async function extractJobFromLinkedIn(url) {
            // Lista de servi√ßos proxy para tentar
            const proxyServices = [
                { name: 'AllOrigins', url: `https://api.allorigins.win/get?url=${encodeURIComponent(url)}`, type: 'json' },
                { name: 'CORS Anywhere', url: `https://cors-anywhere.herokuapp.com/${url}`, type: 'text' },
                { name: 'CodeTabs', url: `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(url)}`, type: 'text' }
            ];
            
            let lastError = null;
            
            for (let i = 0; i < proxyServices.length; i++) {
                const proxy = proxyServices[i];
                try {
                    toggleExtractLoader(true, `Tentando ${proxy.name}...`);
                    console.log(`Tentando proxy ${i + 1} (${proxy.name}):`, proxy.url);
                    
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 15000); // 15 segundos
                    
                    const response = await fetch(proxy.url, {
                        headers: {
                            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36',
                            'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8',
                            'Accept-Language': 'en-US,en;q=0.9,pt;q=0.8'
                        },
                        signal: controller.signal
                    });
                    
                    clearTimeout(timeoutId);
                    
                    if (!response.ok) {
                        throw new Error(`Erro HTTP: ${response.status} - ${response.statusText}`);
                    }
                    
                    toggleExtractLoader(true, `Processando conte√∫do...`);
                    
                    let htmlContent;
                    
                    if (proxy.type === 'json') {
                        const data = await response.json();
                        htmlContent = data.contents;
                    } else {
                        htmlContent = await response.text();
                    }
                    
                    if (!htmlContent || htmlContent.length < 1000) {
                        throw new Error('Conte√∫do HTML insuficiente ou vazio');
                    }
                    
                    // Criar um parser DOM tempor√°rio
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(htmlContent, 'text/html');
                    
                    // Tentar diferentes seletores para encontrar a descri√ß√£o da vaga
                    const selectors = [
                        '.description__text',
                        '.show-more-less-html__markup',
                        '.jobs-description__content',
                        '.jobs-box__html-content',
                        '[data-test="job-description"]',
                        '.jobs-description-content__text',
                        '.jobs-description',
                        '.job-description',
                        '.description',
                        '.jobs-description-details',
                        '.jobs-box__html-content > *',
                        '.core-section-container__content',
                        '.jobs-unified-description',
                        '.jobs-description-content'
                    ];
                    
                    let jobDescription = '';
                    
                    for (const selector of selectors) {
                        const element = doc.querySelector(selector);
                        if (element) {
                            // Limpar HTML e extrair texto
                            const textContent = element.textContent || element.innerText;
                            jobDescription = cleanJobDescription(textContent);
                            
                            if (jobDescription.length > 200) { // Validar se tem conte√∫do significativo
                                console.log(`Descri√ß√£o encontrada usando seletor: ${selector} (proxy ${proxy.name})`);
                                console.log(`Tamanho da descri√ß√£o: ${jobDescription.length} caracteres`);
                                break;
                            }
                        }
                    }
                    
                    // Se n√£o encontrou com seletores espec√≠ficos, tentar buscar por texto
                    if (!jobDescription || jobDescription.length < 200) {
                        console.log('Tentando extra√ß√£o por padr√µes de texto...');
                        jobDescription = extractJobDescriptionFromText(htmlContent);
                    }
                    
                    // Valida√ß√£o final
                    if (jobDescription && jobDescription.length >= 100) {
                        console.log(`Extra√ß√£o bem-sucedida com ${proxy.name}! Tamanho: ${jobDescription.length} caracteres`);
                        return jobDescription;
                    } else {
                        throw new Error(`Descri√ß√£o muito curta ou vazia (${jobDescription.length} caracteres)`);
                    }
                    
                } catch (error) {
                    console.error(`Proxy ${proxy.name} falhou:`, error.message);
                    lastError = error;
                    
                    // Se n√£o √© o √∫ltimo proxy, continuar tentando
                    if (i < proxyServices.length - 1) {
                        console.log(`Tentando pr√≥ximo proxy...`);
                        await new Promise(resolve => setTimeout(resolve, 1000)); // Aguardar 1 segundo
                        continue;
                    }
                }
            }
            
            // Se chegou aqui, todos os proxies falharam
            throw new Error(`Todos os m√©todos de extra√ß√£o falharam. √öltimo erro: ${lastError?.message || 'Desconhecido'}`);
        }
        
        function cleanJobDescription(text) {
            if (!text) return '';
            
            let cleaned = text
                // Remover m√∫ltiplos espa√ßos em branco e quebras de linha
                .replace(/\s+/g, ' ')
                // Remover caracteres de controle
                .replace(/[\x00-\x1F\x7F]/g, '')
                // Manter caracteres b√°sicos de pontua√ß√£o e texto
                .replace(/[^\w\s\-.,;:()\[\]\/&%@#$*+=<>?!'"¬∞]/g, ' ')
                // Remover textos comuns do LinkedIn que n√£o s√£o da descri√ß√£o
                .replace(/Show more|Show less|See more|See less|LinkedIn/gi, '')
                .replace(/Apply now|Easy Apply|Be among the first.*?applicants/gi, '')
                .replace(/Posted.*?ago|.*?applicants|.*?viewers/gi, '')
                .replace(/Save|Report this job|Flag as inappropriate/gi, '')
                .replace(/Skip to main content|Skip navigation/gi, '')
                // Remover elementos de navega√ß√£o comuns
                .replace(/Main content starts here, tab to start navigating/gi, '')
                .replace(/Search jobs|Job search|Filter jobs/gi, '')
                // Limpar in√≠cio e fim de frases comuns
                .replace(/^(About this job|Job description|Description|Job Details)/gi, '')
                .replace(/(Apply for this job|Submit application)$/gi, '')
                // Remover m√∫ltiplos espa√ßos novamente
                .replace(/\s+/g, ' ')
                // Trim final
                .trim();
                
            // Se o texto ainda est√° muito curto ou parece inv√°lido
            if (cleaned.length < 50 || cleaned.match(/^[^a-zA-Z]*$/)) {
                return '';
            }
            
            // Verificar se o texto parece ser uma descri√ß√£o v√°lida (cont√©m algumas palavras-chave)
            const hasJobKeywords = /\b(experience|skills|responsibility|qualifications|requirements|role|position|job|work|team|company|candidate|application|degree|years|knowledge|ability)\b/i.test(cleaned);
            
            if (!hasJobKeywords && cleaned.length < 200) {
                return '';
            }
            
            return cleaned;
        }
        
        function extractJobDescriptionFromText(html) {
            console.log('Iniciando extra√ß√£o de texto simples...');
            try {
                // Remover tags HTML de forma simples
                let text = html;
                
                // Remover elementos n√£o desejados
                text = text.replace(/<script[^>]*>[\s\S]*?<\/script>/gi, '');
                text = text.replace(/<style[^>]*>[\s\S]*?<\/style>/gi, '');
                text = text.replace(/<nav[^>]*>[\s\S]*?<\/nav>/gi, '');
                text = text.replace(/<header[^>]*>[\s\S]*?<\/header>/gi, '');
                text = text.replace(/<footer[^>]*>[\s\S]*?<\/footer>/gi, '');
                
                // Remover todas as tags HTML
                text = text.replace(/</g, ' ');
                text = text.replace(/>/g, ' ');
                
                // Normalizar espa√ßos
                text = text.replace(/\s+/g, ' ').trim();
                
                // Procurar por descri√ß√µes usando indexOf
                const jobKeywords = ['about the job', 'job description', 'responsibilities', 'what you will do'];
                const endKeywords = ['qualifications', 'requirements', 'apply now', 'skills'];
                
                let bestDescription = '';
                
                for (let i = 0; i < jobKeywords.length; i++) {
                    const keyword = jobKeywords[i];
                    const startPos = text.toLowerCase().indexOf(keyword);
                    
                    if (startPos >= 0) {
                        let endPos = text.length;
                        
                        for (let j = 0; j < endKeywords.length; j++) {
                            const endKeyword = endKeywords[j];
                            const foundEnd = text.toLowerCase().indexOf(endKeyword, startPos + keyword.length);
                            if (foundEnd >= 0 && foundEnd < endPos) {
                                endPos = foundEnd;
                            }
                        }
                        
                        const description = text.substring(startPos + keyword.length, endPos);
                        const cleaned = cleanJobDescription(description);
                        
                        if (cleaned.length > bestDescription.length && cleaned.length > 100) {
                            bestDescription = cleaned;
                        }
                    }
                }
                
                if (bestDescription) {
                    console.log('Descri√ß√£o encontrada com sucesso');
                    return bestDescription;
                }
                
                return '';
                
            } catch (error) {
                console.error('Erro na extra√ß√£o:', error);
                return '';
            }
        }

        function toggleExtractLoader(isLoading, status = '') {
            extractJobButton.disabled = isLoading;
            extractLoader.classList.toggle('hidden', !isLoading);
            
            if (isLoading) {
                extractButtonText.textContent = status || 'Extraindo...';
            } else {
                extractButtonText.textContent = 'Extrair Descri√ß√£o';
            }
        }

        function updateLanguageSelection() {
            const selectedLanguage = document.querySelector('input[name="resumeLanguage"]:checked').value;
            console.log('Selected language:', selectedLanguage);
        }

        async function handleFileSelect(event) {
            const file = event.target.files[0];
            
            if (!file) {
                fileNameDisplay.textContent = 'Nenhum arquivo selecionado';
                resumeText = '';
                return;
            }
            
            const validation = validateFileInput(file);
            if (!validation.valid) {
                fileNameDisplay.textContent = validation.error;
                fileNameDisplay.classList.add('text-red-500');
                resumeText = '';
                return;
            }
            
            fileNameDisplay.textContent = file.name;
            fileNameDisplay.classList.remove('text-red-500');
            
            try {
                resumeText = await extractTextFromPdf(file);
                if (!resumeText || resumeText.trim().length === 0) {
                    throw new Error('N√£o foi poss√≠vel extrair texto do PDF');
                }
            } catch (err) {
                showError('Erro no PDF', 'N√£o foi poss√≠vel ler o conte√∫do do arquivo PDF: ' + err.message);
                resumeText = '';
                fileNameDisplay.textContent = 'Erro ao processar o arquivo';
                fileNameDisplay.classList.add('text-red-500');
            }
        }

        async function extractTextFromPdf(file) {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
            let fullText = '';
            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const textContent = await page.getTextContent();
                fullText += textContent.items.map(item => item.str).join(' ');
            }
            return fullText;
        }

        function handleTextInput(event) {
            const textValue = event.target.value.trim();
            
            if (textValue) {
                // Atualizar a vari√°vel global com o texto do curr√≠culo
                resumeText = textValue;
                console.log('Texto do curr√≠culo atualizado:', textValue.substring(0, 100) + '...');
            } else {
                // Limpar se vazio
                resumeText = '';
            }
        }

        async function handleResumeGeneration() {
            try {
                checkRateLimit();
                
                // Garantir que resumeText est√° atualizado se o modo texto estiver ativo
                if (!resumeTextMode.classList.contains('hidden')) {
                    resumeText = resumeTextInput.value.trim();
                }
                
                toggleMainLoader(true);
                const prompt = getPrompt('optimize');
                const result = await callGeminiAPI(prompt);
                optimizedMarkdown = result;
                
                // Debug: Log do resultado da API
                console.log('Markdown bruto recebido:', optimizedMarkdown.substring(0, 500) + '...');
                
                // Processar markdown usando a fun√ß√£o robusta
                const htmlContent = processMarkdown(optimizedMarkdown);
                
                // Debug: Log do HTML gerado
                console.log('HTML gerado:', htmlContent.substring(0, 500) + '...');
                
                markdownPreview.innerHTML = DOMPurify.sanitize(htmlContent);
                
                // For√ßar re-renderiza√ß√£o dos estilos
                markdownPreview.classList.remove('prose-output');
                setTimeout(() => {
                    markdownPreview.classList.add('prose-output');
                }, 10);
                
                downloadPdfButton.disabled = false;
                enableFeatureButtons(true);
            } catch (error) {
                console.error('Erro na gera√ß√£o:', error);
                showError('Erro na Otimiza√ß√£o', error.message);
                markdownPreview.innerHTML = DOMPurify.sanitize(`<p class="text-red-500">Falha ao gerar o curr√≠culo. Verifique sua chave de API e os dados fornecidos.</p>`);
                downloadPdfButton.disabled = true;
                enableFeatureButtons(false);
            } finally {
                toggleMainLoader(false);
            }
        }

        async function handleFeatureClick(button, feature) {
            if (button.disabled) return;
            try {
                checkRateLimit();
                
                // Garantir que resumeText est√° atualizado se o modo texto estiver ativo
                if (!resumeTextMode.classList.contains('hidden')) {
                    resumeText = resumeTextInput.value.trim();
                }
                
                toggleFeatureLoader(button, true);
                const prompt = getPrompt(feature, optimizedMarkdown);
                const result = await callGeminiAPI(prompt);
                const titles = {
                    atsScore: "Score de Ader√™ncia ATS",
                    analyze: "An√°lise Completa de Curr√≠culo",
                    questions: "Sugest√µes para Entrevista",
                    coverLetter: "Rascunho da Carta de Apresenta√ß√£o",
                    linkedin: "Otimiza√ß√£o para Perfil do LinkedIn",
                    followup: "Rascunho de E-mail de Agradecimento",
                    pitch: "Gerador de Pitch Pessoal",
                    star: "Construtor de Hist√≥rias (M√©todo STAR)",
                    summary: "Resumo de Qualifica√ß√µes Focado na Vaga",
                    salary: "An√°lise Salarial: CLT vs PJ"
                };
                showContentModal(titles[feature], result);
            } catch (error) {
                showError(`Erro na feature: ${feature}`, error.message);
            } finally {
                toggleFeatureLoader(button, false);
            }
        }

        async function callGeminiAPI(prompt) {
            const apiKey = apiKeyInput.value.trim();
            
            // Obter descri√ß√£o da vaga do campo ativo
            let jobDescription;
            if (jobUrlMode.classList.contains('hidden')) {
                // Modo texto ativo
                jobDescription = jobDescriptionInput.value.trim();
            } else {
                // Modo URL ativo - usar texto extra√≠do ou o campo principal
                jobDescription = extractedJobTextInput.value.trim() || jobDescriptionInput.value.trim();
            }

            if (!apiKey || !jobDescription || !resumeText) {
                let missing = [];
                if (!apiKey) missing.push("Chave de API");
                if (!jobDescription) missing.push("Descri√ß√£o da Vaga");
                if (!resumeText) missing.push("Curr√≠culo (PDF ou Texto)");
                throw new Error(`Dados Incompletos. Por favor, preencha: ${missing.join(', ')}.`);
            }
            
            // Validar formato da chave de API
            if (!validateApiKey(apiKey)) {
                throw new Error('Chave de API inv√°lida. Verifique se a chave est√° no formato correto.');
            }

            // Limitar tamanho do prompt para evitar ataques DoS
            if (prompt.length > 100000) {
                throw new Error('Prompt muito longo. Reduza o conte√∫do e tente novamente.');
            }

            const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            // Sistema de retry com backoff exponencial
            const maxRetries = 3;
            let attempt = 0;
            
            while (attempt < maxRetries) {
                try {
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 45000); // Timeout maior para retries

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 
                            'Content-Type': 'application/json',
                            'User-Agent': 'Resume-Optimizer/1.0'
                        },
                        body: JSON.stringify(payload),
                        signal: controller.signal
                    });

                    clearTimeout(timeoutId);

                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({}));
                        const errorMessage = errorData.error?.message || `Erro na API: ${response.status} ${response.statusText}`;
                        
                        // Verificar se √© erro de sobrecarga (retryable)
                        const isOverloadError = errorMessage.toLowerCase().includes('overloaded') || 
                                              errorMessage.toLowerCase().includes('quota') ||
                                              errorMessage.toLowerCase().includes('rate limit') ||
                                              response.status === 429 || response.status === 503;
                        
                        if (isOverloadError && attempt < maxRetries - 1) {
                            attempt++;
                            const waitTime = Math.pow(2, attempt) * 1000 + Math.random() * 1000; // Backoff exponencial com jitter
                            console.log(`Tentativa ${attempt}/${maxRetries} falhou. Aguardando ${Math.round(waitTime/1000)}s...`);
                            
                            // Mostrar progresso ao usu√°rio
                            if (typeof showTemporaryMessage === 'function') {
                                showTemporaryMessage(`üîÑ API ocupada. Tentativa ${attempt}/${maxRetries}... Aguardando ${Math.round(waitTime/1000)}s`);
                            }
                            
                            await new Promise(resolve => setTimeout(resolve, waitTime));
                            continue;
                        }
                        
                        // Melhorar mensagem para usu√°rio final
                        if (isOverloadError) {
                            throw new Error('üî• A API do Google est√° muito ocupada no momento. Aguarde alguns minutos e tente novamente. Este erro √© tempor√°rio e comum em hor√°rios de pico.');
                        }
                        
                        throw new Error(errorMessage);
                    }

                    const result = await response.json();

                    if (result.candidates && result.candidates.length > 0 && result.candidates[0].content.parts[0].text) {
                        const responseText = result.candidates[0].content.parts[0].text;
                        
                        // Valida√ß√£o b√°sica da resposta
                        if (responseText.length > 200000) {
                            throw new Error('Resposta da API muito longa. Tente novamente.');
                        }
                        
                        return responseText;
                    } else {
                        throw new Error("A API n√£o retornou uma resposta v√°lida. A resposta pode estar bloqueada por pol√≠ticas de seguran√ßa.");
                    }
                } catch (error) {
                    if (error.name === 'AbortError') {
                        if (attempt < maxRetries - 1) {
                            attempt++;
                            console.log(`Timeout na tentativa ${attempt}/${maxRetries}. Tentando novamente...`);
                            
                            // Mostrar progresso ao usu√°rio
                            if (typeof showTemporaryMessage === 'function') {
                                showTemporaryMessage(`‚è±Ô∏è Timeout. Tentativa ${attempt}/${maxRetries}...`);
                            }
                            
                            continue;
                        }
                        throw new Error('‚è±Ô∏è Timeout na conex√£o. A API est√° respondendo lentamente. Tente novamente em alguns minutos.');
                    }
                    
                    // Se n√£o for um erro retryable, lan√ßar imediatamente
                    if (!error.message.includes('overloaded') && !error.message.includes('quota') && !error.message.includes('rate limit')) {
                        throw error;
                    }
                    
                    // Se chegou ao limite de tentativas
                    if (attempt >= maxRetries - 1) {
                        throw error;
                    }
                    
                    attempt++;
                    const waitTime = Math.pow(2, attempt) * 1000 + Math.random() * 1000;
                    console.log(`Erro na tentativa ${attempt}/${maxRetries}. Aguardando ${Math.round(waitTime/1000)}s...`);
                    
                    // Mostrar progresso ao usu√°rio
                    if (typeof showTemporaryMessage === 'function') {
                        showTemporaryMessage(`üîÑ Erro tempor√°rio. Tentativa ${attempt}/${maxRetries}... Aguardando ${Math.round(waitTime/1000)}s`);
                    }
                    
                    await new Promise(resolve => setTimeout(resolve, waitTime));
                }
            }
        }
          function downloadAsPdf() {
            if (!optimizedMarkdown) {
                showError('Nenhum Conte√∫do', 'N√£o h√° curr√≠culo gerado para baixar.');
                return;
            }

            // Gerar nome do arquivo
            let fileName = pdfFileNameInput.value.trim();
            if (!fileName) {
                fileName = generateFileNameFromJobDescription();
            }

            // Garantir que termine com .pdf
            if (!fileName.endsWith('.pdf')) {
                fileName += '.pdf';
            }

            const doc = new jsPDF({ orientation: 'p', unit: 'pt', format: 'a4' });
            const pageWidth = doc.internal.pageSize.getWidth();
            const pageHeight = doc.internal.pageSize.getHeight();
            const margin = 50;
            const contentWidth = pageWidth - margin * 2;
            let cursorY = margin;

            // Usar marked para parsing correto do markdown
            const tokens = marked.lexer(optimizedMarkdown);

            // Fun√ß√£o para adicionar rodap√© profissional com data
            const addFooter = (pageNumber = null) => {
                const currentPage = pageNumber || doc.getCurrentPageInfo().pageNumber;
                const originalPage = doc.getCurrentPageInfo().pageNumber;

                if (pageNumber) {
                    doc.setPage(pageNumber);
                }

                const now = new Date();
                const dateStr = now.toLocaleDateString('pt-BR');

                // Salvar configura√ß√µes atuais
                const originalFontSize = doc.internal.getFontSize();
                const originalFont = doc.getFont();

                doc.setFontSize(8);
                doc.setFont('Helvetica', 'normal');
                doc.setTextColor(120, 120, 120);

                const footerText = `Gerado em ${dateStr} - ResumeAI Pro`;
                const textWidth = doc.getTextWidth(footerText);
                const xPosition = (pageWidth - textWidth) / 2; // Centralizado

                doc.text(footerText, xPosition, pageHeight - 25);

                // Restaurar configura√ß√µes originais
                doc.setFontSize(originalFontSize);
                doc.setFont(originalFont.fontName, originalFont.fontStyle);
                doc.setTextColor(0, 0, 0); // Preto

                if (pageNumber) {
                    doc.setPage(originalPage);
                }
            };

            // Fun√ß√£o para adicionar texto com melhor suporte a caracteres especiais
            const addText = (text, options = {}) => {
                if (!text || text.trim() === '') return;
                
                // Normalizar e limpar texto para melhor compatibilidade
                let cleanText = text.normalize('NFC');
                // Substituir caracteres que podem causar problemas
                cleanText = cleanText
                    .replace(/[""]/g, '"')  // Aspas curvas para retas
                    .replace(/['']/g, "'")  // Ap√≥strofes curvos para retos
                    .replace(/[‚Äì‚Äî]/g, '-')  // Em dash e en dash para h√≠fen
                    .replace(/‚Ä¶/g, '...')   // Retic√™ncias
                    .replace(/‚Ä¢/g, '-');    // Bullet para h√≠fen
                
                const fontSize = options.size || 10;
                const fontStyle = options.style || 'normal';
                const indent = options.indent || 0;
                const spacing = options.spacing || 8;
                const lineHeight = fontSize * 1.4;
                
                doc.setFont('Helvetica', fontStyle);
                doc.setFontSize(fontSize);

                // Dividir texto em linhas que cabem na p√°gina
                const lines = doc.splitTextToSize(cleanText, contentWidth - indent - 10);
                
                lines.forEach((line, index) => {
                    // Verificar se precisa de nova p√°gina
                    if (cursorY + lineHeight > pageHeight - margin - 40) {
                        doc.addPage();
                        cursorY = margin;
                        // Adicionar rodap√© na p√°gina anterior
                        addFooter(doc.getCurrentPageInfo().pageNumber - 1);
                    }
                    
                    doc.text(line, margin + indent, cursorY);
                    cursorY += lineHeight;
                });
                
                cursorY += spacing;
            };

            // Fun√ß√£o para adicionar separador de se√ß√£o profissional
            const addSectionSeparator = () => {
                if (cursorY + 25 > pageHeight - margin - 30) {
                    doc.addPage();
                    cursorY = margin;
                }
                cursorY += 12;
                doc.setDrawColor(70, 70, 70);
                doc.setLineWidth(1);
                doc.line(margin, cursorY, pageWidth - margin, cursorY);
                cursorY += 18;
            };

            // Fun√ß√£o para processar tokens do marked
            const processToken = (token, isFirstSection = false) => {
                switch (token.type) {
                    case 'heading':
                        // Espa√ßamento antes de novos cabe√ßalhos (exceto o primeiro)
                        if (!isFirstSection && token.depth <= 2) {
                            addSectionSeparator();
                        }
                        
                        const headingSizes = {
                            1: { size: 16, spacing: 18 },
                            2: { size: 14, spacing: 16 },
                            3: { size: 12, spacing: 14 },
                            4: { size: 11, spacing: 12 },
                            5: { size: 10, spacing: 10 },
                            6: { size: 10, spacing: 10 }
                        };
                        
                        const headingStyle = headingSizes[token.depth] || headingSizes[6];
                        addText(token.text, { 
                            size: headingStyle.size, 
                            style: 'bold', 
                            spacing: headingStyle.spacing 
                        });
                        break;
                        
                    case 'paragraph':
                        // Detectar se o par√°grafo cont√©m texto em negrito
                        if (token.tokens && token.tokens.some(t => t.type === 'strong')) {
                            addText(token.text, { size: 10, style: 'bold', spacing: 10 });
                        } else {
                            addText(token.text, { size: 10, spacing: 10 });
                        }
                        break;
                        
                    case 'list':
                        token.items.forEach((item, index) => {
                            // Usar h√≠fen ASCII para m√°xima compatibilidade
                            const bullet = token.ordered ? `${index + 1}.` : '-';
                            const itemText = (item.text || '').replace(/‚Ä¢/g, '-'); // For√ßar h√≠fen
                            addText(`${bullet} ${itemText}`, { 
                                size: 10, 
                                indent: 20, 
                                spacing: 6 
                            });
                        });
                        cursorY += 8; // Espa√ßamento ap√≥s lista
                        break;
                        
                    case 'hr':
                        addSectionSeparator();
                        break;
                        
                    case 'blockquote':
                        addText(token.text, { 
                            size: 10, 
                            style: 'italic', 
                            indent: 20, 
                            spacing: 10 
                        });
                        break;
                        
                    case 'space':
                        cursorY += 6; // Espa√ßamento para quebras de linha
                        break;
                        
                    default:
                        if (token.text && token.text.trim()) {
                            addText(token.text, { size: 10, spacing: 8 });
                        }
                }
            };

            // Processar todos os tokens
            let isFirstToken = true;
            tokens.forEach(token => {
                processToken(token, isFirstToken);
                // S√≥ o primeiro token de cabe√ßalho principal n√£o tem separador
                if (isFirstToken && token.type === 'heading' && token.depth <= 2) {
                    isFirstToken = false;
                }
            });

            // Adicionar rodap√© em todas as p√°ginas ao final
            const totalPages = doc.getNumberOfPages();
            for (let i = 1; i <= totalPages; i++) {
                addFooter(i);
            }

            doc.save(fileName);
        }

        /**
         * Selects and builds the correct prompt for the desired feature.
         * Added new prompts for 'pitch' and 'star'.
         * User inputs are now sanitized.
         */
        function getPrompt(type, markdownInput = '') {
            // Obter descri√ß√£o da vaga do campo ativo
            let jobDescValue;
            if (jobUrlMode.classList.contains('hidden')) {
                // Modo texto ativo
                jobDescValue = jobDescriptionInput.value;
            } else {
                // Modo URL ativo - usar texto extra√≠do ou o campo principal
                jobDescValue = extractedJobTextInput.value || jobDescriptionInput.value;
            }
            
            const jobDesc = sanitizeForPrompt(jobDescValue);
            const originalResume = sanitizeForPrompt(resumeText);
            const markdown = sanitizeForPrompt(markdownInput); // Sanitize the markdown input from optimized resume
            const selectedLanguage = document.querySelector('input[name="resumeLanguage"]:checked').value;
            
            // Language-specific instructions
            const languageInstructions = {
                'pt-br': 'Responda em portugu√™s brasileiro. Use formata√ß√£o e terminologia adequadas ao mercado de trabalho brasileiro.',
                'en': 'Respond in English. Use professional formatting and terminology appropriate for the international job market.'
            };
            
            const langInstruction = languageInstructions[selectedLanguage];

            const baseOptimizePrompt = `[Persona] Aja como um Estrategista de Carreira e Redator de Curr√≠culos especialista em otimiza√ß√£o para ATS. [Contexto] Reescreva o curr√≠culo para maximizar a compatibilidade com a vaga. [Entradas] \nDescri√ß√£o da Vaga: \n\`\`\`${jobDesc}\`\`\`\n\nTexto do Curr√≠culo Atual:\n\`\`\`${originalResume}\`\`\`\n\n[Instru√ß√µes] Analise a vaga, identifique palavras-chave, e reescreva o curr√≠culo se√ß√£o por se√ß√£o. ${langInstruction} [Formato da Sa√≠da] Produza o curr√≠culo final em formato Markdown limpo e de coluna √∫nica. Use --- para separar se√ß√µes. [Restri√ß√£o CR√çTICA] O resultado DEVE come√ßar diretamente com o conte√∫do do curr√≠culo. N√ÉO inclua nenhuma frase introdut√≥ria ou coment√°rio.`;

            switch (type) {
                case 'optimize':
                    return baseOptimizePrompt;
                case 'atsScore':
                    return `[Persona] Especialista em ATS (Applicant Tracking Systems). [Contexto] Calcular score de ader√™ncia entre curr√≠culo e vaga. [Entradas]\nDescri√ß√£o da Vaga:\n\`\`\`${jobDesc}\`\`\`\n\nCurr√≠culo Original:\n\`\`\`${originalResume}\`\`\`\n\nCurr√≠culo Otimizado:\n\`\`\`${markdown}\`\`\`\n\n[Instru√ß√µes] Compare os curr√≠culos e calcule:\n\n## üìä Score ATS\n\n### Curr√≠culo Original: [X]%\n- Palavras-chave encontradas: X/Y\n- Habilidades t√©cnicas: X/Y\n- Experi√™ncia relevante: X/Y\n\n### Curr√≠culo Otimizado: [Z]%\n- Palavras-chave encontradas: X/Y\n- Habilidades t√©cnicas: X/Y\n- Experi√™ncia relevante: X/Y\n\n### üéØ Melhoria: +[diferen√ßa]%\n\n## Detalhamento\n\n### ‚úÖ Palavras-chave Identificadas\n[Lista das principais palavras-chave da vaga encontradas]\n\n### ‚ö†Ô∏è Palavras-chave Ausentes\n[Lista das palavras-chave importantes que ainda faltam]\n\n### üí° Recomenda√ß√µes\n[3-5 sugest√µes espec√≠ficas para melhorar ainda mais o score]\n\n${langInstruction} [Formato da Sa√≠da] Markdown.`;
                case 'analyze':
                    return `[Persona] Coach de Carreira s√™nior e analista. [Contexto] An√°lise completa do curr√≠culo otimizado. [Entradas]\nDescri√ß√£o da Vaga:\n\`\`\`${jobDesc}\`\`\`\n\nCurr√≠culo Otimizado (Markdown):\n\`\`\`${markdown}\`\`\`\n\n[Instru√ß√µes] Forne√ßa an√°lise detalhada em 4 se√ß√µes:\n\n## üéØ Pontos Fortes\n[Destaque os elementos mais alinhados com a vaga]\n\n## üîß Pontos a Melhorar\n[Sugest√µes construtivas e espec√≠ficas]\n\n## üöÄ Diferenciais Competitivos\n[O que torna este perfil √∫nico para a vaga]\n\n## üìà Pr√≥ximos Passos\n[A√ß√µes concretas para fortalecer a candidatura]\n\n${langInstruction} [Formato da Sa√≠da] Markdown com cabe√ßalhos.`;
                case 'questions':
                    return `[Persona] Gerente de Contrata√ß√£o experiente. [Contexto] Preparar para entrevista. [Entradas]\nDescri√ß√£o da Vaga:\n\`\`\`${jobDesc}\`\`\`\n\nCurr√≠culo do Candidato (Markdown):\n\`\`\`${markdown}\`\`\`\n\n[Instru√ß√µes] Crie duas listas: "Perguntas que o Entrevistador Pode Fazer" e "Perguntas Inteligentes para Voc√™ Fazer". ${langInstruction} [Formato da Sa√≠da] Markdown com cabe√ßalhos.`;
                case 'coverLetter':
                    return `[Persona] Redator Profissional. [Contexto] Escrever uma carta de apresenta√ß√£o. [Entradas]\nDescri√ß√£o da Vaga:\n\`\`\`${jobDesc}\`\`\`\n\nCurr√≠culo do Candidato (Markdown):\n\`\`\`${markdown}\`\`\`\n\n[Instru√ß√µes] Escreva um rascunho de carta de apresenta√ß√£o profissional de 3 par√°grafos. ${langInstruction} [Formato da Sa√≠da] Markdown.`;
                case 'linkedin':
                    return `[Persona] Especialista em Marca Pessoal e LinkedIn. [Contexto] Otimizar um perfil do LinkedIn. [Entradas]\nDescri√ß√£o da Vaga:\n\`\`\`${jobDesc}\`\`\`\n\nCurr√≠culo Otimizado (Markdown):\n\`\`\`${markdown}\`\`\`\n\n[Instru√ß√µes] Gere 3 se√ß√µes: 'T√≠tulo Profissional (Headline)', 'Se√ß√£o "Sobre"', e 'Principais Compet√™ncias'. ${langInstruction} [Formato da Sa√≠da] Markdown com cabe√ßalhos.`;
                case 'followup':
                    return `[Persona] Coach de Carreira. [Contexto] Escrever e-mail de agradecimento p√≥s-entrevista. [Entradas]\nDescri√ß√£o da Vaga:\n\`\`\`${jobDesc}\`\`\`\n\n[Instru√ß√µes] Crie um rascunho de e-mail de agradecimento. Use placeholders como '[Nome do Entrevistador]' e '[Seu Nome]'. O e-mail deve ter assunto claro, agradecer, reiterar interesse, e mencionar um ponto positivo da conversa. ${langInstruction} [Formato da Sa√≠da] Texto formatado como e-mail.`;
                case 'pitch':
                    return `[Persona] Coach de Carreira especialista em entrevistas. [Contexto] Criar um "pitch" para a pergunta "Fale sobre voc√™". [Entradas]\nDescri√ß√£o da Vaga:\n\`\`\`${jobDesc}\`\`\`\n\nCurr√≠culo Otimizado (Markdown):\n\`\`\`${markdown}\`\`\`\n\n[Instru√ß√µes] Crie um pitch pessoal de 3 par√°grafos (m√°ximo de 150 palavras). 1¬∫ par√°grafo: Apresenta√ß√£o (profiss√£o, anos de experi√™ncia). 2¬∫ par√°grafo: Conecte suas habilidades e uma conquista chave do curr√≠culo aos requisitos da vaga. 3¬∫ par√°grafo: Expresse entusiasmo pela vaga e o que espera alcan√ßar. ${langInstruction} [Formato da Sa√≠da] Markdown.`;                case 'star':
                    return `[Persona] Coach de Entrevistas Comportamentais. [Contexto] Estruturar experi√™ncias usando o m√©todo STAR (Situa√ß√£o, Tarefa, A√ß√£o, Resultado). [Entradas]\nDescri√ß√£o da Vaga:\n\`\`\`${jobDesc}\`\`\`\n\nCurr√≠culo Otimizado (Markdown):\n\`\`\`${markdown}\`\`\`\n\n[Instru√ß√µes] Selecione as 2 experi√™ncias profissionais mais relevantes do curr√≠culo. Para cada uma, estruture-a no formato STAR: **Situa√ß√£o:** (O contexto/desafio), **Tarefa:** (Sua responsabilidade), **A√ß√£o:** (O que voc√™ fez), **Resultado:** (O impacto quantificado). ${langInstruction} [Formato da Sa√≠da] Markdown com cabe√ßalhos claros para cada hist√≥ria e para S, T, A, R.`;                case 'salary':
                    return `[Persona] Consultor de Remunera√ß√£o especialista no mercado brasileiro. [Contexto] Calcular pretens√£o salarial para CLT e PJ de forma pr√°tica e objetiva. [Entradas]\nDescri√ß√£o da Vaga:\n\`\`\`${jobDesc}\`\`\`\n\nCurr√≠culo Otimizado (Markdown):\n\`\`\`${markdown}\`\`\`\n\n[Instru√ß√µes] Forne√ßa uma an√°lise concisa e pr√°tica seguindo exatamente esta estrutura:

## üìä AN√ÅLISE DA VAGA
- **N√≠vel:** (J√∫nior/Pleno/S√™nior/Especialista)
- **Setor:** (identifique o setor)
- **Localiza√ß√£o:** (infira: SP/RJ/Remoto/Nacional)
- **Porte da empresa:** (Startup/M√©dia/Grande)

## üë§ SEU PERFIL
- **Experi√™ncia relevante:** X anos
- **Match com a vaga:** (Alto/M√©dio/Baixo) - justifique brevemente
- **Diferencial:** (principal ponto forte para esta vaga)

## üí∞ VALORES SUGERIDOS

### CLT
- **Sal√°rio bruto:** R$ X.XXX a R$ X.XXX
- **Com benef√≠cios t√≠picos:** ~R$ X.XXX (VR + Plano + outros)
- **Custo total empresa:** ~R$ X.XXX (para sua refer√™ncia)

### PJ
- **Valor/hora:** R$ XXX (160h/m√™s)
- **Faturamento mensal:** R$ X.XXX
- **L√≠quido estimado:** ~R$ X.XXX (descontando impostos simples)

## üéØ RECOMENDA√á√ÉO
**Modalidade mais vantajosa:** [CLT/PJ/Equivalente]
**Justificativa:** (1-2 frases explicando o porqu√™)

## üí¨ COMO NEGOCIAR
### Se perguntarem sua pretens√£o:
- **CLT:** "Estou buscando algo entre R$ X.XXX e R$ X.XXX, dependendo do pacote de benef√≠cios"
- **PJ:** "Meu valor/hora √© R$ XXX, que d√° aproximadamente R$ X.XXX mensais"

### Dicas r√°pidas:
- Sempre d√™ uma faixa, nunca um valor fixo
- Pesquise no Glassdoor/Vagas.com antes de negociar
- Considere benef√≠cios como parte da negocia√ß√£o

${langInstruction} [FORMATO OBRIGAT√ìRIO] Markdown exatamente como estruturado acima. Seja direto, use valores realistas do mercado brasileiro atual.`;
                case 'summary':
                    return `[Persona] Redator Profissional especialista em curr√≠culos. [Contexto] Criar um resumo executivo de qualifica√ß√µes focado especificamente na vaga. [Entradas]\nDescri√ß√£o da Vaga:\n\`\`\`${jobDesc}\`\`\`\n\nCurr√≠culo Otimizado (Markdown):\n\`\`\`${markdown}\`\`\`\n\n[Instru√ß√µes] Crie um resumo executivo de 3-4 frases que destaque as qualifica√ß√µes mais relevantes do candidato para esta vaga espec√≠fica. O resumo deve: 1) Mencionar anos de experi√™ncia na √°rea relevante; 2) Destacar as 2-3 compet√™ncias t√©cnicas mais alinhadas com a vaga; 3) Incluir uma conquista quantificada que demonstre impacto; 4) Conectar diretamente o perfil aos requisitos da vaga. ${langInstruction} [Formato da Sa√≠da] Par√°grafo √∫nico em Markdown, conciso e impactante, ideal para usar no topo do curr√≠culo.`;
                default:
                    return '';
            }
        }


        function generateFileNameFromJobDescription() {
            // Obter descri√ß√£o da vaga do campo ativo
            let jobDesc;
                       if (jobUrlMode.classList.contains('hidden')) {
                // Modo texto ativo
                jobDesc = jobDescriptionInput.value.trim();
            } else {
                // Modo URL ativo - usar texto extra√≠do ou o campo principal
                jobDesc = extractedJobTextInput.value.trim() || jobDescriptionInput.value.trim();
            }
            
            if (!jobDesc) {
                return 'curriculo-otimizado';
            }

            let fileName = jobDesc
                .toLowerCase()
                .replace(/[^\w\s-]/g, '')
                .replace(/\s+/g, '-')
                .substring(0, 100);

            const jobTitlePatterns = [
                /vaga\s+(?:de|para)\s+([^.,:;]+)/i,
                /contrata[√ßc]√£o\s+(?:de|para)\s+([^.,:;]+)/i,
                /busca(?:mos)?\s+([^.,:;]+)/i,
                /desenvolvedor[a]?\s+([\w\s]+)/i,
                /analista\s+([\w\s]+)/i,
                /gerente\s+([\w\s]+)/i,
                /coordenador[a]?\s+([\w\s]+)/i,
                /especialista\s+([\w\s]+)/i,
                /consultor[a]?\s+([\w\s]+)/i,
                /engenheiro[a]?\s+([\w\s]+)/i
            ];

            for (const pattern of jobTitlePatterns) {
                const match = jobDesc.match(pattern);
                if (match && match[1]) {
                    const extractedTitle = match[1]
                        .trim()
                        .toLowerCase()
                        .replace(/[^\w\s]/g, '')
                        .replace(/\s+/g, '-')
                        .substring(0, 50);

                    if (extractedTitle.length > 3) {
                        return `curriculo-${extractedTitle}`;
                    }
                }
            }

            const words = fileName.split('-').filter(word => word.length > 2).slice(0, 5);
            return words.length > 0 ? `curriculo-${words.join('-')}` : 'curriculo-otimizado';
        }

        function sanitizeForPrompt(text) {
            if (typeof text !== 'string') return '';
            // Escape backticks and other potentially dangerous characters
            return text
                .replace(/`/g, '\\`')
                .replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '') // Remove script tags
                .replace(/javascript:/gi, '') // Remove javascript: protocol
                .replace(/on\w+\s*=/gi, '') // Remove event handlers
                .substring(0, 50000); // Limit length to prevent DoS
        }

        // Fun√ß√£o para validar chave de API
        function validateApiKey(apiKey) {
            if (!apiKey || typeof apiKey !== 'string') return false;
            // Valida√ß√£o b√°sica do formato da chave de API do Google AI Studio
            const apiKeyPattern = /^[A-Za-z0-9_-]{39}$/;
            return apiKeyPattern.test(apiKey.trim());
        }

        // Fun√ß√£o para sanitizar entrada de arquivo
        function validateFileInput(file) {
            if (!file) return { valid: false, error: 'Nenhum arquivo selecionado' };
            
            const MAX_FILE_SIZE = 10 * 1024 * 1024; // 10MB
            const ALLOWED_TYPES = ['application/pdf'];
            
            if (!ALLOWED_TYPES.includes(file.type)) {
                return { valid: false, error: 'Tipo de arquivo n√£o permitido. Apenas PDF √© aceito.' };
            }
            
            if (file.size > MAX_FILE_SIZE) {
                return { valid: false, error: 'Arquivo muito grande. M√°ximo 10MB.' };
            }
            
            return { valid: true };
        }

        // --- UI Helper Functions ---

        function toggleMainLoader(isLoading) {
            generateButton.disabled = isLoading;
            loader.classList.toggle('hidden', !isLoading);
            buttonText.textContent = isLoading ? 'Gerando...' : 'Gerar Curr√≠culo Otimizado';
        }

        function toggleFeatureLoader(button, isLoading) {
            button.disabled = isLoading;
            if (isLoading) {
                const icon = button.querySelector('.feature-icon').textContent;
                button.innerHTML = DOMPurify.sanitize(`
                    <div class="feature-icon mb-2 animate-pulse">
                        <div class="feature-loader mx-auto"></div>
                    </div>
                    <span class="font-semibold text-xs">Processando...</span>
                `);
            } else {
                button.innerHTML = DOMPurify.sanitize(button.getAttribute('data-original-text'));
            }
        }

        function enableFeatureButtons(isEnabled) {
            Object.keys(featureButtons).forEach(key => {
                const btn = featureButtons[key];
                btn.disabled = !isEnabled;

                // Remove all style classes first
                btn.className = btn.className.replace(/bg-gradient-to-br[^\s]*|from-[^\s]*|to-[^\s]*|text-[^\s]*|hover:[^\s]*|border-[^\s]*|transform[^\s]*|scale-[^\s]*|shadow-[^\s]*|opacity-[^\s]*|cursor-[^\s]*/g, '').replace(/\s+/g, ' ').trim();
                
                // Preserve layout classes
                let layoutClasses = '';
                if (btn.className.includes('md:col-span-2')) layoutClasses += ' md:col-span-2';
                if (btn.className.includes('lg:col-span-3')) layoutClasses += ' lg:col-span-3';
                
                // Apply base classes and state-specific styles
                btn.className = `${baseBtnClasses}${layoutClasses} ${isEnabled ? enabledBtnClasses : disabledBtnClasses}`;

                if(isEnabled && !btn.hasAttribute('data-original-text')) {
                    btn.setAttribute('data-original-text', btn.innerHTML);
                    // Add click effect only once
                    if (!btn.hasEventListeners) {
                        btn.addEventListener('mouseenter', function() {
                            if (!this.disabled) {
                                this.style.transform = 'translateY(-2px) scale(1.02)';
                            }
                        });
                        btn.addEventListener('mouseleave', function() {
                            if (!this.disabled) {
                                this.style.transform = 'translateY(0) scale(1)';
                            }
                        });
                        btn.hasEventListeners = true;
                    }
                }
            });
        }

        function showError(title, message) {
            errorModalTitle.textContent = title;
            errorModalMessage.textContent = message;
            errorModal.classList.remove('hidden');
        }

        function showTemporaryMessage(message, duration = 3000) {
            // Remover mensagem anterior se existir
            const existing = document.getElementById('temp-message');
            if (existing) existing.remove();
            
            // Criar nova mensagem tempor√°ria
            const tempDiv = document.createElement('div');
            tempDiv.id = 'temp-message';
            tempDiv.className = 'fixed top-4 right-4 bg-blue-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 text-sm font-medium animate-pulse';
            tempDiv.textContent = message;
            
            document.body.appendChild(tempDiv);
            
            // Remover automaticamente ap√≥s o tempo especificado
            setTimeout(() => {
                if (tempDiv.parentNode) {
                    tempDiv.remove();
                }
            }, duration);
        }

        function showContentModal(title, markdownContent) {
            contentModalTitle.textContent = title;
            
            // Processar markdown usando a fun√ß√£o robusta
            const htmlContent = processMarkdown(markdownContent);
            contentModalBody.innerHTML = DOMPurify.sanitize(htmlContent);
            
            contentModal.classList.remove('hidden');
        }

        async function validateLinkedInUrl(url) {
            try {
                // Verificar se a URL responde (mesmo que seja bloqueada pelo CORS)
                const response = await fetch(url, { 
                    method: 'HEAD',
                    mode: 'no-cors'
                });
                return true; // Se chegou at√© aqui, a URL existe
            } catch (error) {
                // Mesmo com erro de CORS, se for um erro de rede, a URL pode n√£o existir
                if (error.message.includes('Failed to fetch') || error.message.includes('Network')) {
                    return false;
                }
                return true; // Outros erros (como CORS) indicam que a URL existe
            }
        }
    </script>
<script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "teiwdomoe7");
</script>
</body>
</html>
